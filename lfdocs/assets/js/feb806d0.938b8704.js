"use strict";(globalThis.webpackChunkdocusaurus_classic_typescript=globalThis.webpackChunkdocusaurus_classic_typescript||[]).push([[32064],{28453:(e,t,n)=>{n.d(t,{R:()=>o,x:()=>c});var s=n(96540);const r={},i=s.createContext(r);function o(e){const t=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function c(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),s.createElement(i.Provider,{value:t},e.children)}},75042:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>a,contentTitle:()=>o,default:()=>h,frontMatter:()=>i,metadata:()=>c,toc:()=>l});var s=n(74848),r=n(28453);const i={title:"Regression Tests",description:"Regression Tests for Lingua Franca."},o=void 0,c={id:"developer/regression-tests",title:"Regression Tests",description:"Regression Tests for Lingua Franca.",source:"@site/versioned_docs/version-0.11.0/developer/regression-tests.mdx",sourceDirName:"developer",slug:"/developer/regression-tests",permalink:"/docs/developer/regression-tests",draft:!1,unlisted:!1,editUrl:"https://github.com/lf-lang/lf-lang.github.io/tree/master/versioned_docs/version-0.11.0/developer/regression-tests.mdx",tags:[],version:"0.11.0",frontMatter:{title:"Regression Tests",description:"Regression Tests for Lingua Franca."},sidebar:"handbookSidebar",previous:{title:"On-target Development",permalink:"/docs/developer/on-target-development"},next:{title:"Running Benchmarks",permalink:"/docs/developer/running-benchmarks"}},a={},l=[{value:"Running the Tests From the Command Line",id:"running-the-tests-from-the-command-line",level:2},{value:"Reporting Bugs",id:"reporting-bugs",level:2},{value:"Testing Architecture",id:"testing-architecture",level:2},{value:"Known Failures",id:"known-failures",level:3},{value:"Test Output",id:"test-output",level:3},{value:"Code Coverage",id:"code-coverage",level:2},{value:"Continuous Integration",id:"continuous-integration",level:2}];function d(e){const t={a:"a",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.p,{children:"Lingua Franca comes with an extensive set of regression tests that are executed on various platforms automatically whenever an update is pushed to the LF repository. There are two categories of tests:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Unit tests"})," are Java methods in our code base that are labeled with the ",(0,s.jsx)(t.code,{children:"@Test"})," directive. These tests check individual functions of the code generation infrastructure. These are located in the ",(0,s.jsx)(t.code,{children:"core/src/test"})," directory."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Integration tests"})," are complete Lingua Franca programs that are compiled and executed automatically. A test passes if it successfully compiles and runs to completion with normal termination (return code 0). These tests are located in the ",(0,s.jsx)(t.code,{children:"test"})," directory at the root of the LF repo, with one subdirectory per target language.\nTheir implementation can be found in the ",(0,s.jsx)(t.code,{children:"core/src/integrationTest"})," directory.\nThe integration tests are also executed through JUnit using methods with ",(0,s.jsx)(t.code,{children:"@Test"})," directives, but they are executed separately."]}),"\n"]}),"\n",(0,s.jsx)(t.h2,{id:"running-the-tests-from-the-command-line",children:"Running the Tests From the Command Line"}),"\n",(0,s.jsxs)(t.p,{children:["To run all unit tests, simply run ",(0,s.jsx)(t.code,{children:"./gradlew test"}),". Note that also the normal build tasks ",(0,s.jsx)(t.code,{children:"./gradlew build"})," runs all the unit tests."]}),"\n",(0,s.jsxs)(t.p,{children:["The integration tests can be run using the ",(0,s.jsx)(t.code,{children:"integrationTest"})," task. However, typically it is not desired to run all tests for all targets locally as it will need the right target tooling and will take a long time."]}),"\n",(0,s.jsxs)(t.p,{children:["To run only the integration tests for one target, we provide the ",(0,s.jsx)(t.code,{children:"targetTest"})," gradle task. For instance, you can use the following command to run all Rust tests:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{children:"./gradlew targetTest -Ptarget=Rust\n"})}),"\n",(0,s.jsxs)(t.p,{children:["You can specify any valid target. If you run the task without specifying the target property ",(0,s.jsx)(t.code,{children:"./gradlew targetTest"})," it will produce an error message and list all available targets."]}),"\n",(0,s.jsxs)(t.p,{children:["The ",(0,s.jsx)(t.code,{children:"targetTest"})," task is essentially a convenient shortcut for the following:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{children:'./gradlew core:integrationTest --tests "org.lflang.tests.runtime.<target>Test.*"\n'})}),"\n",(0,s.jsx)(t.p,{children:"If you prefer have more control over which tests are executed, you can also use this more verbose version."}),"\n",(0,s.jsx)(t.p,{children:"It is also possible to run a subset of the tests. For example, the C tests are organized into the following categories:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"generic"})," tests are ",(0,s.jsx)(t.code,{children:".lf"})," files located in ",(0,s.jsx)(t.code,{children:"$LF/test/C/src"}),"."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"concurrent"})," tests are ",(0,s.jsx)(t.code,{children:".lf"})," files located in ",(0,s.jsx)(t.code,{children:"$LF/test/C/src/concurrent"}),"."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"federated"})," tests are ",(0,s.jsx)(t.code,{children:".lf"})," files located in ",(0,s.jsx)(t.code,{children:"$LF/test/C/src/federated"}),"."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"multiport"})," tests are ",(0,s.jsx)(t.code,{children:".lf"})," files located in ",(0,s.jsx)(t.code,{children:"$LF/test/C/src/multiport"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(t.p,{children:["To invoke only the C tests in the ",(0,s.jsx)(t.code,{children:"concurrent"})," category, for example, run this:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{children:"./gradlew core:integrationTest --tests org.lflang.tests.runtime.CTest.runConcurrentTests\n"})}),"\n",(0,s.jsxs)(t.p,{children:["Sometimes it is convenient to only run a single specific test case. This can be done with the ",(0,s.jsx)(t.code,{children:"singleTest"})," task. For instance:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{children:"./gradlew singleTest -DsingleTest=test/C/src/Minimal.lf\n"})}),"\n",(0,s.jsx)(t.h2,{id:"reporting-bugs",children:"Reporting Bugs"}),"\n",(0,s.jsx)(t.p,{children:"If you encounter a bug or add some enhancement to Lingua Franca, then you should create a regression test either as a system test or a unit test and issue a pull request. System tests are particularly easy to create since they are simply Lingua Franca programs that either compile and execute successfully (the test passes) or fail either to compile or execute."}),"\n",(0,s.jsx)(t.h2,{id:"testing-architecture",children:"Testing Architecture"}),"\n",(0,s.jsxs)(t.p,{children:["System tests can be put in any subdirectory of ",(0,s.jsx)(t.code,{children:"$LF/test"})," or ",(0,s.jsx)(t.code,{children:"$LF/example"}),".\nAny ",(0,s.jsx)(t.code,{children:".lf"})," file within these directories will be treated as a system test unless they are within a directory named ",(0,s.jsx)(t.code,{children:"failing"}),", in which case they will be ignored.\nThe tests are automatically indexed by our JUnit-based test infrastructure, which is located in the package ",(0,s.jsx)(t.code,{children:"core/src/integrationTest"}),". Each target has its own class in the ",(0,s.jsx)(t.code,{children:"runtime"})," package, with a number of test methods that correspond to particular test categories, such as ",(0,s.jsx)(t.code,{children:"generic"}),", ",(0,s.jsx)(t.code,{children:"concurrent"}),", ",(0,s.jsx)(t.code,{children:"federated"}),", etc. A test can be associated with a particular category by placing it in a directory that matches its name. For instance, we can create a test (e.g., ",(0,s.jsx)(t.code,{children:"Foo.lf"}),") in ",(0,s.jsx)(t.code,{children:"test/C/src/concurrent"}),", which will then get indexed under the target ",(0,s.jsx)(t.code,{children:"C"})," in the category ",(0,s.jsx)(t.code,{children:"concurrent"}),". Files placed directly in ",(0,s.jsx)(t.code,{children:"test/C/src"})," will be considered ",(0,s.jsx)(t.code,{children:"generic"})," ",(0,s.jsx)(t.code,{children:"C"})," tests, and a file in a directory ",(0,s.jsx)(t.code,{children:"concurrent/federated"})," will be indexed as ",(0,s.jsx)(t.code,{children:"federated"})," (corresponding to the nearest containing directory)."]}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"Caution"}),": adding a ",(0,s.jsx)(t.em,{children:"new"})," category requires updating an enum in ",(0,s.jsx)(t.code,{children:"TestRegistry.java"})," and adding a ",(0,s.jsx)(t.code,{children:"@Test"}),"-labeled method to ",(0,s.jsx)(t.code,{children:"TestBase"}),"."]}),"\n",(0,s.jsx)(t.h3,{id:"known-failures",children:"Known Failures"}),"\n",(0,s.jsxs)(t.p,{children:["Sometimes it is useful to retain tests that have a known failure that should be addressed at a later point. Such tests can simply be put in a directory called ",(0,s.jsx)(t.code,{children:"failing"}),", which will tell our test indexing code to exclude it."]}),"\n",(0,s.jsx)(t.h3,{id:"test-output",children:"Test Output"}),"\n",(0,s.jsxs)(t.p,{children:['Tests are grouped by target and category. It is also reported when, for a given category, there are other targets that feature tests that are missing for the target under test. Tests that either do not have a main reactor or are marked as known failures are reported as "ignored." For all the tests that were successfully indexed, it is reported how many passed. For each failing test, diagnostics are reported that should help explain the failure. Here is some sample output for ',(0,s.jsx)(t.code,{children:"Ctest.runConcurrentTests"}),", which runs tests categorized as ",(0,s.jsx)(t.code,{children:"concurrent"})," for the ",(0,s.jsx)(t.code,{children:"C"})," target:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{children:"CTest > runConcurrentTests() STANDARD_OUT\n    ==============================================================================\n    Target: C\n    Description: Run concurrent tests.\n    ==============================================================================\n\n    ==============================================================================\n    Category: CONCURRENT\n    ==============================================================================\n    ------------------------------------------------------------------------------\n    Ignored: 0\n    ------------------------------------------------------------------------------\n\n    ------------------------------------------------------------------------------\n    Covered: 29/33\n    ------------------------------------------------------------------------------\n    Missing: src/concurrent/BankToBank.lf\n    Missing: src/concurrent/BankToBankMultiport.lf\n    Missing: src/concurrent/BankToBankMultiportAfter.lf\n    Missing: src/concurrent/BankToMultiport.lf\n\n    ------------------------------------------------------------------------------\n    Passing: 29/29\n    ------------------------------------------------------------------------------\n\n"})}),"\n",(0,s.jsx)(t.h2,{id:"code-coverage",children:"Code Coverage"}),"\n",(0,s.jsxs)(t.p,{children:["Code coverage is automatically recorded when running tests.\nA combined report for each subproject can be created by running ",(0,s.jsx)(t.code,{children:"./gradlew jacocoTestReport"}),".\nFor the ",(0,s.jsx)(t.code,{children:"core"})," subproject, the html report will be located in ",(0,s.jsx)(t.code,{children:"build/reports/html/index.html"}),".\nNote that this report will only reflect the coverage of the test that have actually executed."]}),"\n",(0,s.jsx)(t.h2,{id:"continuous-integration",children:"Continuous Integration"}),"\n",(0,s.jsxs)(t.p,{children:["Each push or pull request will trigger all tests to be run on GitHub Actions. It's configuration can be found ",(0,s.jsx)(t.a,{href:"https://github.com/lf-lang/lingua-franca/tree/master/.github/workflows",children:"here"}),"."]})]})}function h(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}}}]);