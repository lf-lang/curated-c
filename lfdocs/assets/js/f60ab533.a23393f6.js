"use strict";(globalThis.webpackChunkdocusaurus_classic_typescript=globalThis.webpackChunkdocusaurus_classic_typescript||[]).push([[10895],{8351:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>re,contentTitle:()=>te,default:()=>se,frontMatter:()=>ee,metadata:()=>ae,toc:()=>ne});var r,n,i,s,l,c,o,h,d,p,g,u,m,f,x,b,j,v,y,w,T,k,E,C,S,z,A,F,M,L,_,R,G,H,O,I,P,D,N,V,U,B,q,J,Y,W=a(74848),K=a(28453),Q=a(31848),X=a(96540);function $(){return $=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)({}).hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},$.apply(null,arguments)}const Z=({title:e,titleId:t,...a})=>X.createElement("svg",$({xmlns:"http://www.w3.org/2000/svg",width:249,height:177,baseProfile:"full",viewBox:"0 0 249 177","aria-labelledby":t},a),e?X.createElement("title",{id:t},e):null,r||(r=X.createElement("desc",null,"Creator: FreeHEP Graphics2D Driver Producer: de.cau.cs.kieler.klighd.piccolo.freehep.SemanticSVGGraphics2D Revision Source:  Date: Friday, March 24, 2023 at 7:39:05 PM Central European Standard Time")),X.createElement("g",{strokeMiterlimit:10},n||(n=X.createElement("path",{fill:"#fff",d:"M0 0h249.1v177H0z"})),i||(i=X.createElement("path",{fill:"#fff",d:"M.5 8.5v160a8 8 0 0 0 8 8h232.1a8 8 0 0 0 8-8V8.5a8 8 0 0 0-8-8H8.5a8 8 0 0 0-8 8"})),s||(s=X.createElement("path",{fill:"none",stroke:"#bebebe",d:"M.5 8.5v160a8 8 0 0 0 8 8h232.1a8 8 0 0 0 8-8V8.5a8 8 0 0 0-8-8H8.5a8 8 0 0 0-8 8z"})),X.createElement("text",{y:10,fontFamily:"Helvetica",fontSize:10,lengthAdjust:"spacingAndGlyphs",style:{whiteSpace:"pre"},textLength:47,transform:"translate(88.55 6)"},"Feedback"),l||(l=X.createElement("path",{fill:"#bebebe",d:"M141.05 14.5v1a2 2 0 0 0 2 2h15a2 2 0 0 0 2-2v-1a2 2 0 0 0-2-2h-15a2 2 0 0 0-2 2"})),c||(c=X.createElement("path",{fill:"none",stroke:"#bebebe",d:"M141.05 14.5v1a2 2 0 0 0 2 2h15a2 2 0 0 0 2-2v-1a2 2 0 0 0-2-2h-15a2 2 0 0 0-2 2z"})),o||(o=X.createElement("path",{fill:"#bebebe",d:"M146.05 14.56a3.5 3.5 0 1 1-7 0 3.5 3.5 0 0 1 7 0"})),h||(h=X.createElement("path",{fill:"none",stroke:"#bebebe",d:"M146.05 14.56a3.5 3.5 0 1 1-7 0 3.5 3.5 0 0 1 7 0z"})),d||(d=X.createElement("path",{fill:"#bebebe",d:"M149.05 12.333a2.833 2.833 0 1 1-5.667 0 2.833 2.833 0 0 1 5.667 0"})),p||(p=X.createElement("path",{fill:"none",stroke:"#bebebe",d:"M149.05 12.333a2.833 2.833 0 1 1-5.667 0 2.833 2.833 0 0 1 5.667 0z"})),g||(g=X.createElement("path",{fill:"#bebebe",d:"M156.85 13a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0"})),u||(u=X.createElement("path",{fill:"none",stroke:"#bebebe",d:"M156.85 13a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0z"})),m||(m=X.createElement("path",{fill:"#f2f2f2",d:"M14 37.5v58a8 8 0 0 0 8 8h96a8 8 0 0 0 8-8v-58a8 8 0 0 0-8-8H22a8 8 0 0 0-8 8"})),f||(f=X.createElement("path",{fill:"none",stroke:"#bebebe",d:"M14 37.5v58a8 8 0 0 0 8 8h96a8 8 0 0 0 8-8v-58a8 8 0 0 0-8-8H22a8 8 0 0 0-8 8z"})),X.createElement("text",{y:10,fontFamily:"Helvetica",fontSize:10,lengthAdjust:"spacingAndGlyphs",style:{whiteSpace:"pre"},textLength:41,transform:"translate(49.5 35)"},"f1 : Fed1"),x||(x=X.createElement("path",{fill:"#f2f2f2",d:"M54 68c0 8.008-6.492 14.5-14.5 14.5S25 76.008 25 68s6.492-14.5 14.5-14.5S54 59.992 54 68"})),b||(b=X.createElement("path",{fill:"none",stroke:"#000",d:"M54 68c0 8.008-6.492 14.5-14.5 14.5S25 76.008 25 68s6.492-14.5 14.5-14.5S54 59.992 54 68z"})),j||(j=X.createElement("path",{fill:"none",stroke:"#000",d:"M39.5 56v12l6 6"})),X.createElement("text",{y:8,fontFamily:"Helvetica",fontSize:8,lengthAdjust:"spacingAndGlyphs",style:{whiteSpace:"pre"},textLength:40,transform:"translate(19.5 88)"},"(10 msec)"),v||(v=X.createElement("path",{fill:"#a6a6a6",d:"M74.5 57h39l6 11-6 11h-39l6-11z"})),y||(y=X.createElement("path",{fill:"none",stroke:"#737373",d:"M74.5 57h39l6 11-6 11h-39l6-11z"})),w||(w=X.createElement("path",{fill:"none",stroke:"#000",strokeDasharray:"3,1",d:"M54.5 68h26M119.5 68h3.7"})),X.createElement("text",{y:8,fontFamily:"Helvetica",fontSize:8,lengthAdjust:"spacingAndGlyphs",style:{whiteSpace:"pre"},textLength:5,transform:"translate(133.2 57)"},"x"),T||(T=X.createElement("path",{d:"m123.2 64 8 4-8 4z"})),k||(k=X.createElement("path",{fill:"none",stroke:"#000",d:"m123.2 64 8 4-8 4z"})),E||(E=X.createElement("path",{fill:"#f2f2f2",d:"M165.4 41.5v72a8 8 0 0 0 8 8h42a8 8 0 0 0 8-8v-72a8 8 0 0 0-8-8h-42a8 8 0 0 0-8 8"})),C||(C=X.createElement("path",{fill:"none",stroke:"#bebebe",d:"M165.4 41.5v72a8 8 0 0 0 8 8h42a8 8 0 0 0 8-8v-72a8 8 0 0 0-8-8h-42a8 8 0 0 0-8 8z"})),X.createElement("text",{y:10,fontFamily:"Helvetica",fontSize:10,lengthAdjust:"spacingAndGlyphs",style:{whiteSpace:"pre"},textLength:43,transform:"translate(172.9 39)"},"f2 : Fed2"),S||(S=X.createElement("path",{fill:"#a6a6a6",d:"M171.9 57h39l6 11-6 11h-39l6-11z"})),z||(z=X.createElement("path",{fill:"none",stroke:"#737373",d:"M171.9 57h39l6 11-6 11h-39l6-11z"})),X.createElement("text",{y:10,fontFamily:"Helvetica",fontSize:10,fontWeight:"bold",lengthAdjust:"spacingAndGlyphs",style:{whiteSpace:"pre"},textLength:5,transform:"translate(191.9 62)"},"1"),A||(A=X.createElement("path",{fill:"#a6a6a6",d:"M171.9 94h39l6 11-6 11h-39l6-11z"})),F||(F=X.createElement("path",{fill:"none",stroke:"#737373",d:"M171.9 94h39l6 11-6 11h-39l6-11z"})),X.createElement("text",{y:10,fontFamily:"Helvetica",fontSize:10,fontWeight:"bold",lengthAdjust:"spacingAndGlyphs",style:{whiteSpace:"pre"},textLength:7,transform:"translate(190.9 99)"},"2"),M||(M=X.createElement("path",{fill:"none",stroke:"#000",strokeDasharray:"3,1",d:"M168.2 68h9.7M216.9 68h3.7M168.2 105h9.7"})),X.createElement("text",{y:8,fontFamily:"Helvetica",fontSize:8,lengthAdjust:"spacingAndGlyphs",style:{whiteSpace:"pre"},textLength:5,transform:"translate(153.2 57)"},"x"),L||(L=X.createElement("path",{d:"m160.2 64 8 4-8 4z"})),_||(_=X.createElement("path",{fill:"none",stroke:"#000",d:"m160.2 64 8 4-8 4z"})),X.createElement("text",{y:8,fontFamily:"Helvetica",fontSize:8,lengthAdjust:"spacingAndGlyphs",style:{whiteSpace:"pre"},textLength:5,transform:"translate(153.2 94)"},"z"),R||(R=X.createElement("path",{d:"m160.2 101 8 4-8 4z"})),G||(G=X.createElement("path",{fill:"none",stroke:"#000",d:"m160.2 101 8 4-8 4z"})),X.createElement("text",{y:8,fontFamily:"Helvetica",fontSize:8,lengthAdjust:"spacingAndGlyphs",style:{whiteSpace:"pre"},textLength:5,transform:"translate(230.6 57)"},"y"),H||(H=X.createElement("path",{d:"m220.6 64 8 4-8 4z"})),O||(O=X.createElement("path",{fill:"none",stroke:"#000",d:"m220.6 64 8 4-8 4z"})),I||(I=X.createElement("path",{fill:"#f2f2f2",d:"M68 127.5v35a8 8 0 0 0 8 8h42a8 8 0 0 0 8-8v-35a8 8 0 0 0-8-8H76a8 8 0 0 0-8 8"})),P||(P=X.createElement("path",{fill:"none",stroke:"#bebebe",d:"M68 127.5v35a8 8 0 0 0 8 8h42a8 8 0 0 0 8-8v-35a8 8 0 0 0-8-8H76a8 8 0 0 0-8 8z"})),X.createElement("text",{y:10,fontFamily:"Helvetica",fontSize:10,lengthAdjust:"spacingAndGlyphs",style:{whiteSpace:"pre"},textLength:44,transform:"translate(75 125)"},"f3 : Fed3"),D||(D=X.createElement("path",{fill:"#a6a6a6",d:"M74.5 143h39l6 11-6 11h-39l6-11z"})),N||(N=X.createElement("path",{fill:"none",stroke:"#737373",d:"M74.5 143h39l6 11-6 11h-39l6-11z"})),V||(V=X.createElement("path",{fill:"none",stroke:"#000",strokeDasharray:"3,1",d:"M70.8 154h9.7M119.5 154h3.7"})),X.createElement("text",{y:8,fontFamily:"Helvetica",fontSize:8,lengthAdjust:"spacingAndGlyphs",style:{whiteSpace:"pre"},textLength:5,transform:"translate(55.8 143)"},"x"),U||(U=X.createElement("path",{d:"m62.8 150 8 4-8 4z"})),B||(B=X.createElement("path",{fill:"none",stroke:"#000",d:"m62.8 150 8 4-8 4z"})),X.createElement("text",{y:8,fontFamily:"Helvetica",fontSize:8,lengthAdjust:"spacingAndGlyphs",style:{whiteSpace:"pre"},textLength:5,transform:"translate(133.2 143)"},"y"),q||(q=X.createElement("path",{d:"m123.2 150 8 4-8 4z"})),J||(J=X.createElement("path",{fill:"none",stroke:"#000",d:"m123.2 150 8 4-8 4zM131.2 68h29M228.6 68h14.5V21H6v133h56.8"})),Y||(Y=X.createElement("path",{fill:"none",stroke:"#000",d:"M131.2 154h14.5v-49h14.5"})))),ee={title:"Tracing",description:"Tracing (preliminary)"},te=void 0,ae={id:"reference/tracing",title:"Tracing",description:"Tracing (preliminary)",source:"@site/versioned_docs/version-0.7.0/reference/tracing.mdx",sourceDirName:"reference",slug:"/reference/tracing",permalink:"/docs/0.7.0/reference/tracing",draft:!1,unlisted:!1,editUrl:"https://github.com/lf-lang/lf-lang.github.io/tree/master/versioned_docs/version-0.7.0/reference/tracing.mdx",tags:[],version:"0.7.0",frontMatter:{title:"Tracing",description:"Tracing (preliminary)"},sidebar:"handbookSidebar",previous:{title:"Target Declaration",permalink:"/docs/0.7.0/reference/target-declaration"},next:{title:"Containerized Execution",permalink:"/docs/0.7.0/reference/containerized-execution"}},re={},ne=[{value:"Tracing in C++",id:"tracing-in-c",level:2},{value:"Usage",id:"usage",level:2},{value:"The Trace View",id:"the-trace-view",level:2},{value:"Supporting Tracing in Other Targets",id:"supporting-tracing-in-other-targets",level:2},{value:"Trace Viewers",id:"trace-viewers",level:2},{value:"Google Trace Viewer",id:"google-trace-viewer",level:3},{value:"Trace Compass",id:"trace-compass",level:3},{value:"Vampir",id:"vampir",level:3},{value:"Tracing in C and Python",id:"tracing-in-c-and-python",level:2},{value:"User-Defined Tracepoints",id:"user-defined-tracepoints",level:3},{value:"Tracing Federated Programs",id:"tracing-federated-programs",level:3}];function ie(e){const t={a:"a",code:"code",em:"em",h2:"h2",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,K.R)(),...e.components};return(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(Q.Gv,{c:!0,cpp:!0,py:!0}),"\n",(0,W.jsx)(t.p,{children:"Tracing is a powerful tool when it comes to analysis and debugging of applications. Unfortunately, most tracing tools that are readily available are designed specifically for analyzing processes, threads and system calls. Specialized tools are required to enable analysis that is tailored to an alternative model of computation such as Reactors. The tools should be capable of understanding the fundamental concepts of the model, such as the distinction between logical and physical time, as well as structural units such as reactors and reactions. This page gives an overview of the currently supported trace mechanism, as well as an outline of alternative tools that could be useful in the future."}),"\n",(0,W.jsxs)(t.p,{children:["Tracing is different from ",(0,W.jsx)(t.a,{href:"/docs/0.7.0/reference/target-declaration#logging",children:"logging"}),". Logging produces human-readable output in textual form and incurs significant overhead. Tracing produces binary data that must be further processed to be useful and is designed to have minimal impact on the execution time of a program."]}),"\n",(0,W.jsx)(t.p,{children:"Tracing is currently supported in the C, Python, and C++ targets. The mechanism used in C and Python is different from that used in C++. Tracing in C++ requires third-party tools that may only be available in Linux. Tracing in C and Python does not require any third-party tools."}),"\n",(0,W.jsxs)(Q.Sk,{children:[(0,W.jsxs)(Q.lr,{cpp:!0,children:[(0,W.jsx)(t.h2,{id:"tracing-in-c",children:"Tracing in C++"}),(0,W.jsxs)(t.p,{children:["Tracing in the C++ target of Lingua Franca is based on three third-party tools. ",(0,W.jsx)(t.a,{href:"https://lttng.org/docs/v2.12/",children:"LTTng"})," is a Linux tool used to instrument the Lingua Franca program and to record traces in the ",(0,W.jsx)(t.a,{href:"https://diamon.org/ctf/",children:"CTF"}),", which minimizes the overhead of instrumentation. Chrome (or Chromium) has a build in ",(0,W.jsx)(t.a,{href:"https://www.chromium.org/developers/how-tos/trace-event-profiling-tool",children:"trace viewer"})," that is used to visualize the recorded trace data in a reactor-specific way. Since the Chrome trace-viewer cannot read CTF traces directly, we use ",(0,W.jsx)(t.a,{href:"https://babeltrace.org/",children:"Babeltrace2"})," to convert the recorded CTF trace to a JSON file that the Google trace viewer can load."]}),(0,W.jsx)(t.h2,{id:"usage",children:"Usage"}),(0,W.jsxs)(t.p,{children:["Some helper scripts that we will use below, can be found in the ",(0,W.jsx)(t.a,{href:"https://github.com/tud-ccc/reactor-cpp/tree/master/tracing",children:"reactor-cpp repository"}),"."]}),(0,W.jsxs)(t.ol,{children:["\n",(0,W.jsxs)(t.li,{children:["\n",(0,W.jsxs)(t.p,{children:["Build and install the user space tools of LTTng (lttng-ust) as described ",(0,W.jsx)(t.a,{href:"https://lttng.org/docs/#doc-installing-lttng",children:"here"}),". On Arch, there is a community package available ",(0,W.jsx)(t.code,{children:"pacman -Sy lttng-ust"}),". On Ubuntu, you need to install ",(0,W.jsx)(t.code,{children:"lttng-tools"}),", ",(0,W.jsx)(t.code,{children:"lttng-modules-dkms"}),", and ",(0,W.jsx)(t.code,{children:"liblttng-ust-dev"})]}),"\n"]}),"\n",(0,W.jsxs)(t.li,{children:["\n",(0,W.jsxs)(t.p,{children:["Build and install Babeltrace2 and its python bindings as described ",(0,W.jsx)(t.a,{href:"https://github.com/efficios/babeltrace/blob/stable-2.0/README.adoc",children:"here"}),". In most cases, the following steps should work:"]}),"\n",(0,W.jsxs)(t.ol,{children:["\n",(0,W.jsx)(t.li,{children:(0,W.jsx)(t.code,{children:"git clone --branch v2.0.4 git@github.com:efficios/babeltrace.git"})}),"\n",(0,W.jsx)(t.li,{children:(0,W.jsx)(t.code,{children:"cd babeltrace"})}),"\n",(0,W.jsx)(t.li,{children:(0,W.jsx)(t.code,{children:"./bootstrap"})}),"\n",(0,W.jsx)(t.li,{children:(0,W.jsx)(t.code,{children:"./configure --prefix=/path/to/preferred/install/location --enable-python-bindings --disable-debug-info --disable-man-pages"})}),"\n",(0,W.jsx)(t.li,{children:(0,W.jsx)(t.code,{children:"make install"})}),"\n"]}),"\n"]}),"\n",(0,W.jsxs)(t.li,{children:["\n",(0,W.jsx)(t.p,{children:"Make sure babeltrace is available on your path:"}),"\n",(0,W.jsxs)(t.ol,{children:["\n",(0,W.jsx)(t.li,{children:(0,W.jsx)(t.code,{children:"export PYTHONPATH=${PYTHONPATH}:/path/to/preferred/install/location/lib/python3.8/site-packages"})}),"\n",(0,W.jsx)(t.li,{children:(0,W.jsx)(t.code,{children:"export LD_LIBRARY_PATH=${LD_LIBRARY_PATH}:/path/to/preferred/install/location/lib"})}),"\n"]}),"\n"]}),"\n",(0,W.jsxs)(t.li,{children:["\n",(0,W.jsx)(t.p,{children:"Modify the target declaration of your Lingua Franca program to enable tracing:"}),"\n"]}),"\n"]}),(0,W.jsx)(t.pre,{children:(0,W.jsx)(t.code,{className:"language-lf-cpp",children:"target Cpp {\n    tracing: true\n};\n"})}),(0,W.jsxs)(t.ol,{start:"5",children:["\n",(0,W.jsxs)(t.li,{children:["Build the Lingua Franca program. The current build process is not very robust and does not automatically rebuild the reactor-cpp framework with tracing support if an earlier build exist. Be sure to remove all build artifacts ",(0,W.jsx)(t.code,{children:"rm -r bin build include lib share src-gen"})," before triggering a new build. Alternatively, if you compile with ",(0,W.jsx)(t.code,{children:"lfc"}),", you can add ",(0,W.jsx)(t.code,{children:"-c"})," to the command to clean before building."]}),"\n",(0,W.jsxs)(t.li,{children:["Start a LTTng user space session by simply running the ",(0,W.jsx)(t.code,{children:"start_tracing.sh"})," script. This will print the directory in which the recorded traces will be placed."]}),"\n",(0,W.jsx)(t.li,{children:"Run your instrumented Lingua Franca application."}),"\n",(0,W.jsxs)(t.li,{children:["Stop the LTTng session using ",(0,W.jsx)(t.code,{children:"stop_tracing.sh"}),"."]}),"\n",(0,W.jsxs)(t.li,{children:["Convert the recorded CTF trace to a JSON file using ",(0,W.jsx)(t.code,{children:"ctf_to_json.py <lttng-session-dir>"}),". ",(0,W.jsx)(t.code,{children:"<lttng-session-dir>"})," is the output directory reported by ",(0,W.jsx)(t.code,{children:"start_tracing.sh"}),". By default, this produces a file ",(0,W.jsx)(t.code,{children:"trace.json"}),". Optionally, the default output file can be overridden using ",(0,W.jsx)(t.code,{children:"-o"})," or ",(0,W.jsx)(t.code,{children:"--output"}),"."]}),"\n",(0,W.jsxs)(t.li,{children:["Open Chrome (or Chromium) and go to ",(0,W.jsx)(t.code,{children:"about://tracing"}),". Load the previously generated JSON file to visualize it."]}),"\n"]}),(0,W.jsx)(t.h2,{id:"the-trace-view",children:"The Trace View"}),(0,W.jsx)(t.p,{children:(0,W.jsx)(t.img,{src:"https://user-images.githubusercontent.com/6460123/81709144-fcb29a00-9471-11ea-9032-95cb6a368e98.png",alt:"Screenshot_20200512_165849"})}),(0,W.jsxs)(t.p,{children:["The trace visualization consists of two parts. The upper part (labeled ",(0,W.jsx)(t.em,{children:"Execution"}),"), shows the physical time at which reactions are executed by the scheduler or by its worker threads. The lower parts show the reactors of the program. For each reactor, all scheduled actions (red markers) and all triggered reactions (blue markers) are visualized by their logical time. All elements in the trace view can be clicked on to display more detailed information."]}),(0,W.jsx)(t.h2,{id:"supporting-tracing-in-other-targets",children:"Supporting Tracing in Other Targets"}),(0,W.jsxs)(t.p,{children:["The same mechanism as described above can be used to trace Lingua Franca applications in other target languages. The key is to instrument the target runtime in order to produce CTF traces. ",(0,W.jsx)(t.a,{href:"https://lttng.org/docs/",children:"LTTng"})," comes with support for multiple languages. As a fallback solution, C can be used to define the trace points which then can be used from the target language through a foreign function interface. It should also be considered, to use an alternative library in the target language that is capable of producing CTF traces. The only requirement is that the generated CTF events have a similar structure, as it is currently used in the C++ target. See ",(0,W.jsx)(t.a,{href:"https://github.com/tud-ccc/reactor-cpp/blob/master/include/reactor-cpp/trace.hh",children:"trace.hh"})," in ",(0,W.jsx)(t.a,{href:"https://github.com/tud-ccc/reactor-cpp",children:"reactor-cpp"})," to get an overview of the available trace points."]}),(0,W.jsx)(t.h2,{id:"trace-viewers",children:"Trace Viewers"}),(0,W.jsx)(t.p,{children:"This section gives a brief overview of trace viewers that could be applicable for tracing Lingua Franca applications."}),(0,W.jsx)(t.h3,{id:"google-trace-viewer",children:"Google Trace Viewer"}),(0,W.jsxs)(t.p,{children:["The Google Trace Viewer is the only viewer currently supported. Since it reads JSON files, it is easy to use and a conversion script can easily tailor the trace data such that it is correctly displayed by the viewer. Documentation of the JSON trace format can be found ",(0,W.jsx)(t.a,{href:"https://docs.google.com/document/d/1CvAClvFfyA5R-PhYUmn5OOQtYMH4h6I0nSsKchNAySU/preview#",children:"here"}),". There is also a list of available ",(0,W.jsx)(t.a,{href:"https://github.com/catapult-project/catapult/blob/master/tracing/tracing/base/color_scheme.html",children:"color codes"}),". The approach of using LTTng for tracing, a converter and Google Trace Viewer can also be used to sample and visualize data live. This is shown in the ",(0,W.jsx)(t.a,{href:"https://clearpathrobotics.com/blog/2020/01/scalopus-tracing-framework-c-python/",children:"Scalapus project"}),"."]}),(0,W.jsx)(t.h3,{id:"trace-compass",children:"Trace Compass"}),(0,W.jsxs)(t.p,{children:[(0,W.jsx)(t.a,{href:"https://www.eclipse.org/tracecompass/",children:"Trace Compass"})," is based on Eclipse and has native support for CTF traces. Due to the Eclipse support, Trace Compass is a natural candidate for integration with the Lingua Franca IDE. However, Trace Compass is tailored for the visualization of kernel traces or running user processes. Out of the box, it cannot make sense of reactor traces. There are various ways to customize Trace Compass in order to properly display the data, but they are difficult to use and/or not well documented."]}),(0,W.jsxs)(t.ol,{children:["\n",(0,W.jsxs)(t.li,{children:["Custom trace analysis and views can be defined in an ",(0,W.jsx)(t.a,{href:"https://archive.eclipse.org/tracecompass/doc/stable/org.eclipse.tracecompass.doc.user/Data-driven-analysis.html",children:"XML format"}),". This probably works well for smaller tasks, but programming a mildly complex analysis in XML without proper error checking and debugging appears ridiculous."]}),"\n",(0,W.jsxs)(t.li,{children:["Custom analysis and views can also be programmed in ",(0,W.jsx)(t.a,{href:"https://archive.eclipse.org/tracecompass.incubator/doc/org.eclipse.tracecompass.incubator.scripting.doc.user/User-Guide.html",children:"scripting languages"})," such as Python or Java Script. However, the tools seem not to be ready for production. I was not able to get the Python support working. Using Java Script the tools worked for simple tasks, but I was not able to come to a satisfactory results due to lack of or incomplete documentation and low customizability."]}),"\n",(0,W.jsxs)(t.li,{children:["Writing a Trace Compass ",(0,W.jsx)(t.a,{href:"https://rtist.hcldoc.com/help/index.jsp?topic=%2Forg.eclipse.tracecompass.doc.dev%2Fdoc%2FView-Tutorial.html",children:"Plugin"}),". This seems to be the most promising approach, but probably requires a considerable amount of work. Writing such a plugin and integrating it with the Lingua Franca IDE could be a nice student project though."]}),"\n"]}),(0,W.jsx)(t.h3,{id:"vampir",children:"Vampir"}),(0,W.jsxs)(t.p,{children:[(0,W.jsx)(t.a,{href:"https://vampir.eu/",children:"Vampir"})," is another powerful tracing tool that is mainly developed at TU Dresden. It targets mostly HPC applications, and I am not sure if it can be adjusted to display specific information other than details of processes and threads."]})]}),(0,W.jsxs)(Q.lr,{c:!0,py:!0,children:[(0,W.jsx)(t.h2,{id:"tracing-in-c-and-python",children:"Tracing in C and Python"}),(0,W.jsxs)(t.p,{children:["The C and Python tracing mechanism depends only on the availability of the ",(0,W.jsx)(t.code,{children:"pthread"})," library. Like C++ tracing, tracing is enabled by a target parameter:"]}),(0,W.jsx)(t.pre,{children:(0,W.jsx)(t.code,{className:"language-lf-c",children:"target C {\n    tracing: true\n};\n"})}),(0,W.jsxs)(t.p,{children:["Once it is enabled, when the compiled program, say ",(0,W.jsx)(t.code,{children:"Foo.lf"}),", is executed, a trace file is created, ",(0,W.jsx)(t.code,{children:"Foo.lft"}),' (the extension is for "Lingua Franca trace"). If you wish to customize the root name of the trace file, you can specify the following target property instead:']}),(0,W.jsx)(t.pre,{children:(0,W.jsx)(t.code,{className:"language-lf-c",children:'target C {\n    tracing: {trace-file-name: "Bar"}\n};\n'})}),(0,W.jsxs)(t.p,{children:["This will result in the trace file being named ",(0,W.jsx)(t.code,{children:"Bar.lft"}),", regardless of the name of the ",(0,W.jsx)(t.code,{children:".lf"})," file."]}),(0,W.jsx)(t.p,{children:"The trace file is a binary file. It is not human readable. There are  utilities for reading it:"}),(0,W.jsxs)(t.ul,{children:["\n",(0,W.jsxs)(t.li,{children:[(0,W.jsx)(t.code,{children:"trace_to_csv"}),": This program creates a text file with one line per traced event in comma-separated list format."]}),"\n",(0,W.jsxs)(t.li,{children:[(0,W.jsx)(t.code,{children:"trace_to_chrome"}),": This program creates a text file in JSON format that is suitable for reading into the same Google Trace Viewer, which runs in Chrome, as used above in C++ tracing."]}),"\n",(0,W.jsxs)(t.li,{children:[(0,W.jsx)(t.code,{children:"trace_to_influxdb"})," : This program will send the traced event to a running InfluxDB database server."]}),"\n",(0,W.jsxs)(t.li,{children:[(0,W.jsx)(t.code,{children:"fedsd"}),": This program creates a timed sequence diagram showing the interactions between components of a federated program (see ",(0,W.jsx)(t.a,{href:"#tracing-federated-programs",children:"Tracing Federated Programs"})," below)."]}),"\n"]}),(0,W.jsxs)(t.p,{children:["These four programs are located in reactor-c at ",(0,W.jsx)(t.code,{children:"lingua-franca/core/src/main/resources/lib/c/reactor-c/util/tracing"}),". Running ",(0,W.jsx)(t.code,{children:"sudo make install"})," in that directory will put executables into ",(0,W.jsx)(t.code,{children:"usr/local/bin"}),"."]}),(0,W.jsxs)(t.p,{children:["Consider for example the ",(0,W.jsx)(t.a,{href:"https://github.com/lf-lang/lingua-franca/blob/master/test/C/src/concurrent/ThreadedThreaded.lf",children:"ThreadedThreaded.lf"})," test, which executes a number of heavyweight computations in parallel on multiple cores. If you enable tracing as shown above and run the program, a ",(0,W.jsx)(t.code,{children:"ThreadedTheread.lft"})," file will appear. Running"]}),(0,W.jsx)(t.pre,{children:(0,W.jsx)(t.code,{className:"language-sh",children:"   trace_to_csv ThreadedThreaded\n"})}),(0,W.jsxs)(t.p,{children:["will create a file called ",(0,W.jsx)(t.code,{children:"ThreadedThreaded.csv"})," that looks like this:"]}),(0,W.jsx)(t.pre,{children:(0,W.jsx)(t.code,{children:"Event, Reactor, Reaction, Worker, Elapsed Logical Time, Microstep, Elapsed Physical Time, Trigger, Extra Delay\nSchedule called, a, 0, 0, 0, 0, 704000, a.t, 0\nSchedule called, a, 0, 0, 0, 0, 704000, a.t, 200000000\nSchedule called, a, 0, 0, 200000000, 0, 177916000, a.t, 200000000\n...\nReaction starts, a, 0, 1, 0, 0, 765000, NO TRIGGER, 0\nReaction ends, a, 0, 1, 0, 0, 765000, NO TRIGGER, 0\nReaction starts, t[0], 0, 1, 0, 0, 793000, NO TRIGGER, 0\nReaction ends, t[0], 0, 1, 0, 0, 177520000, NO TRIGGER, 0\nReaction starts, t[3], 0, 1, 200000000, 0, 177955000, NO TRIGGER, 0\nReaction ends, t[3], 0, 1, 200000000, 0, 348602000, NO TRIGGER, 0\n"})}),(0,W.jsxs)(t.p,{children:["The first line defines each of the columns. For example, the second line records a call to ",(0,W.jsx)(t.code,{children:"lf_schedule()"})," for reactor named ",(0,W.jsx)(t.code,{children:"a"}),", with no associated reaction, in worker thread 0, at (elapsed) logical time 0 with microstep 0. The call occurred at (elapsed) physical time\n704 microseconds and is scheduling the trigger named ",(0,W.jsx)(t.code,{children:"a.t"})," (a timer) with extra delay 0. This file can be imported into any spreadsheet program and sorted and analyzed."]}),(0,W.jsxs)(t.p,{children:["The ",(0,W.jsx)(t.code,{children:"trace_to_csv"})," utility will also create a summary file called ",(0,W.jsx)(t.code,{children:"ThreadedThreaded_summary.csv"})," that looks like this after importing in Excel:"]}),(0,W.jsx)(t.p,{children:(0,W.jsx)(t.img,{alt:"CSV summary file",src:a(98670).A+"",width:"634",height:"418"})}),(0,W.jsx)(t.p,{children:"If you call"}),(0,W.jsx)(t.pre,{children:(0,W.jsx)(t.code,{className:"language-sh",children:"   trace_to_chrome ThreadedThreaded\n"})}),(0,W.jsxs)(t.p,{children:["then a ThreadedThreaded.json file is created. To visualize the data, point your Chrome browser to ",(0,W.jsx)(t.code,{children:"chrome://tracing/"}),". Click on the ",(0,W.jsx)(t.code,{children:"Load"})," button and select the ",(0,W.jsx)(t.code,{children:".json"})," file that you just created. The result should look something like this:"]}),(0,W.jsx)(t.p,{children:(0,W.jsx)(t.img,{alt:"Chrome tracing visualization",src:a(58769).A+"",width:"1890",height:"1152"})}),(0,W.jsxs)(t.p,{children:['The tan-colored regions whose labels start with "A" and "W" represent time spent advancing logical time and waiting for activity on the reaction queue, respectively. When logical time advances, unless you have specified the ',(0,W.jsx)(t.code,{children:"-fast"})," option, one of the worker threads blocks execution until physical time catches up with logical time. The remaining worker threads block waiting for reactions that are ready to execute appear on the reaction queue."]}),(0,W.jsxs)(t.p,{children:["The JSON trace format can be found ",(0,W.jsx)(t.a,{href:"https://docs.google.com/document/d/1CvAClvFfyA5R-PhYUmn5OOQtYMH4h6I0nSsKchNAySU/preview#",children:"here"}),". There is also a list of available ",(0,W.jsx)(t.a,{href:"https://github.com/catapult-project/catapult/blob/master/tracing/tracing/base/color_scheme.html",children:"color codes"}),"."]}),(0,W.jsx)(t.h3,{id:"user-defined-tracepoints",children:"User-Defined Tracepoints"}),(0,W.jsxs)(t.p,{children:["Users can add their own tracepoints in order to provide low-overhead recording of events and events with values that occur during the execution of reactions. To do this, the first step is to register the trace event in a ",(0,W.jsx)(t.strong,{children:"startup"})," reaction as follows:"]}),(0,W.jsx)(t.pre,{children:(0,W.jsx)(t.code,{className:"language-lf-c",children:'    reaction(startup) {=\n        if (!register_user_trace_event("Description of event")) {\n            fprintf(stderr, "ERROR: Failed to register trace event.\\n");\n            exit(1);\n        }\n    =}\n'})}),(0,W.jsx)(t.p,{children:"The description of the event is an arbitrary string, but the string must be unique. All events with the same description will be collected together in any display of events."}),(0,W.jsxs)(t.p,{children:["To then actually record an event, in a reaction, call ",(0,W.jsx)(t.code,{children:"tracepoint_user_event"}),", passing it the same string. E.g.,"]}),(0,W.jsx)(t.pre,{children:(0,W.jsx)(t.code,{className:"language-lf-c",children:'\treaction(in) -> out {=\n\t    ...\n\t    tracepoint_user_event("Description of event");\n\t    ...\n\t=}\n'})}),(0,W.jsxs)(t.p,{children:["You can also pass a value to the trace. The type of the value is ",(0,W.jsx)(t.code,{children:"long long"}),", so it can be a time value or an int. For example,"]}),(0,W.jsx)(t.pre,{children:(0,W.jsx)(t.code,{className:"language-lf-c",children:'\treaction(in) -> out {=\n\t    ...\n\t    tracepoint_user_value("Description of event", 42);\n\t    ...\n\t=}\n'})}),(0,W.jsxs)(t.p,{children:["An example of a Chrome display of a run of the ",(0,W.jsx)(t.a,{href:"https://github.com/lf-lang/lingua-franca/blob/master/test/C/src/concurrent/Tracing.lf",children:"Tracing regression test"})," is here:"]}),(0,W.jsx)(t.p,{children:(0,W.jsx)(t.img,{alt:"Chrome tracing visualization",src:a(98167).A+"",width:"3010",height:"374"})}),(0,W.jsx)(t.p,{children:'In this image, "Number of Destination invocations" is an event description to\nwhich values 1 through 10 were passed. This results in the shaded value plot\nshown first. The other four rows are just pure events (with no value). They are\nshown by (extremely) thin lines positioned at the physical time of the\noccurrence of the event. Dragging the mouse over those thin lines shows further\ndetails about the event in the window below.'}),(0,W.jsx)(t.h3,{id:"tracing-federated-programs",children:"Tracing Federated Programs"}),(0,W.jsxs)(t.p,{children:["When the ",(0,W.jsx)(t.code,{children:"tracing"})," target parameter is set to ",(0,W.jsx)(t.code,{children:"true"})," in a ",(0,W.jsx)(t.a,{href:"/docs/0.7.0/writing-reactors/distributed-execution",children:"federated program"}),", then each federate plus the RTI will generate a binary trace file. The utility ",(0,W.jsx)(t.code,{children:"fedsd"})," generates an HTML file containing an SVG graphic that shows the messages exchanged between components over time. Like the other utilities, ",(0,W.jsx)(t.code,{children:"fedsd"})," is defined in ",(0,W.jsx)(t.code,{children:"lingua_franca/util/tracing"})," and installed using ",(0,W.jsx)(t.code,{children:"make install"}),"."]}),(0,W.jsx)(t.p,{children:"Consider the following LF program:"}),(0,W.jsx)(Z,{title:"Feedback example",width:"300",role:"img"}),(0,W.jsxs)(t.p,{children:["Setting ",(0,W.jsx)(t.code,{children:"tracing: true"})," in this program and running it produces four ",(0,W.jsx)(t.code,{children:".lft"})," files. Running ",(0,W.jsx)(t.code,{children:"fedsd"})," on those files:"]}),(0,W.jsx)(t.pre,{children:(0,W.jsx)(t.code,{children:"   fedsd\n"})}),(0,W.jsxs)(t.p,{children:["results in converting the files to ",(0,W.jsx)(t.code,{children:".csv"})," files and then generating a ",(0,W.jsx)(t.code,{children:"trace_svg.html"})," file. Opening that file reveals a trace, the beginning of which looks like this:"]}),(0,W.jsx)(t.p,{children:(0,W.jsx)(t.img,{alt:"Feedback trace",src:a(17233).A+"",width:"1550",height:"1152"})}),(0,W.jsx)(t.p,{children:"This section of the trace shows only the initial negotiation for the start time for the federation. The vertical axis represents physical time, and the labels on that axis display physical time relative to the start time that is the result of this initial negotiation. The vertical axis is not linear so that more events can be displayed in a small space. The horizontal lines represent messages sent and received, with the message type and tag information (if any) shown."}),(0,W.jsx)(t.p,{children:"A more interesting part of the trace is shown here:"}),(0,W.jsx)(t.p,{children:(0,W.jsx)(t.img,{alt:"Feedback trace",src:a(77605).A+"",width:"1592",height:"1332"})}),(0,W.jsxs)(t.p,{children:["This shows ",(0,W.jsx)(t.code,{children:"f1"})," (on the right) advancing time to 10 ms, and sending a message (in red, via the RTI) to ",(0,W.jsx)(t.code,{children:"f2"}),", which then forwards it to ",(0,W.jsx)(t.code,{children:"f3"})," (again, via the RTI)."]})]})]})]})}function se(e={}){const{wrapper:t}={...(0,K.R)(),...e.components};return t?(0,W.jsx)(t,{...e,children:(0,W.jsx)(ie,{...e})}):ie(e)}},17233:(e,t,a)=>{a.d(t,{A:()=>r});const r=a.p+"assets/images/SDstartup-bdac5777c2837640aaefe70a18a43faf.png"},28453:(e,t,a)=>{a.d(t,{R:()=>s,x:()=>l});var r=a(96540);const n={},i=r.createContext(n);function s(e){const t=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:s(e.components),r.createElement(i.Provider,{value:t},e.children)}},58769:(e,t,a)=>{a.d(t,{A:()=>r});const r=a.p+"assets/images/ChromeTracingInC-74adffc466006c21c1e0ed67a33dd4cc.png"},77605:(e,t,a)=>{a.d(t,{A:()=>r});const r=a.p+"assets/images/Messages-8383c56e100e236f47ec620e40ea462d.png"},98167:(e,t,a)=>{a.d(t,{A:()=>r});const r=a.p+"assets/images/ChromeTracingInC2-95d813a54fa312474edf998eb2a0126d.png"},98670:(e,t,a)=>{a.d(t,{A:()=>r});const r=a.p+"assets/images/ChromeTracingInC3-0a5ea36b3ea1fa903cac74fd107adf62.png"}}]);