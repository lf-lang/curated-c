"use strict";(globalThis.webpackChunkdocusaurus_classic_typescript=globalThis.webpackChunkdocusaurus_classic_typescript||[]).push([[41489],{1589:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>d,contentTitle:()=>t,default:()=>h,frontMatter:()=>c,metadata:()=>s,toc:()=>a});var o=r(74848),i=r(28453);const c={title:"Containerized Execution",description:"Containerized Execution using Docker"},t=void 0,s={id:"reference/containerized-execution",title:"Containerized Execution",description:"Containerized Execution using Docker",source:"@site/versioned_docs/version-0.5.0/reference/containerized-execution.mdx",sourceDirName:"reference",slug:"/reference/containerized-execution",permalink:"/docs/0.5.0/reference/containerized-execution",draft:!1,unlisted:!1,editUrl:"https://github.com/lf-lang/lf-lang.github.io/tree/master/versioned_docs/version-0.5.0/reference/containerized-execution.mdx",tags:[],version:"0.5.0",frontMatter:{title:"Containerized Execution",description:"Containerized Execution using Docker"},sidebar:"handbookSidebar",previous:{title:"Tracing",permalink:"/docs/0.5.0/reference/tracing"},next:{title:"Security",permalink:"/docs/0.5.0/reference/security"}},d={},a=[{value:"Unfederated Execution",id:"unfederated-execution",level:2},{value:"Using docker compose up",id:"using-docker-compose-up",level:3},{value:"Using docker build and docker run",id:"using-docker-build-and-docker-run",level:3},{value:"Federated Execution",id:"federated-execution",level:2},{value:"Using docker compose up",id:"using-docker-compose-up-1",level:3},{value:"Using docker build and docker run",id:"using-docker-build-and-docker-run-1",level:3}];function l(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"C"}),", ",(0,o.jsx)(n.code,{children:"Python"}),", and ",(0,o.jsx)(n.code,{children:"TypeScript"})," target support the generation of a Dockerfile to conveniently run the generated code in a container. To enable this feature, include the ",(0,o.jsx)(n.code,{children:"docker"})," property in your target specification, as follows:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-lf-c",children:"target C {\n    docker: true\n}\n"})}),"\n",(0,o.jsxs)(n.p,{children:["The generated Docker file has the same name as the LF file except that the extension is ",(0,o.jsx)(n.code,{children:".Dockerfile"})," and will be put in the ",(0,o.jsx)(n.code,{children:"src-gen"})," directory. You can also specify options. Currently, only the base image (",(0,o.jsx)(n.code,{children:"FROM"}),") can be customized, but this will be extended to allow further customization is the future. To customize the Docker file, instead of just ",(0,o.jsx)(n.code,{children:"true"})," above, which gives default options, specify the options as in the following example:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-lf-c",children:'target C {\n    docker: {FROM: "alpine:latest"}\n}\n'})}),"\n",(0,o.jsxs)(n.p,{children:["This specifies that the base image is the latest version of ",(0,o.jsx)(n.code,{children:"alpine"}),", a very small Linux. In fact, ",(0,o.jsx)(n.code,{children:"alpine:latest"})," is the default value for this option, so you only need to specify this option if you need something other than ",(0,o.jsx)(n.code,{children:"alpine:latest"}),"."]}),"\n",(0,o.jsxs)(n.p,{children:["How to use this depends on whether your application is federated. You will need to ",(0,o.jsx)(n.a,{href:"https://docs.docker.com/get-docker/",children:"install Docker"})," if you haven't already in order to use this."]}),"\n",(0,o.jsx)(n.h2,{id:"unfederated-execution",children:"Unfederated Execution"}),"\n",(0,o.jsxs)(n.p,{children:["Suppose your LF source file is ",(0,o.jsx)(n.code,{children:"src/Foo.lf"}),". When you run ",(0,o.jsx)(n.code,{children:"lfc"})," or use the IDE to generate code, a file called ",(0,o.jsx)(n.code,{children:"Dockerfile"})," and a file called ",(0,o.jsx)(n.code,{children:"docker-compose.yml"})," will appear in the ",(0,o.jsx)(n.code,{children:"src_gen/Foo"})," directory, see ",(0,o.jsx)(n.a,{href:"/docs/writing-reactors/a-first-reactor#structure-of-an-lf-project",children:"Structure of an LF project"})," for more info."]}),"\n",(0,o.jsx)(n.h3,{id:"using-docker-compose-up",children:"Using docker compose up"}),"\n",(0,o.jsxs)(n.p,{children:["After running ",(0,o.jsx)(n.code,{children:"lfc"}),", change to the directory that contains the generated sources. Then, use ",(0,o.jsx)(n.code,{children:"docker compose up --build"})," to automatically build the Docker image and run the container. Once the container finishes execution, use ",(0,o.jsx)(n.code,{children:"docker compose down"})," in the same directory where ",(0,o.jsx)(n.code,{children:"docker-compose.yml"})," is located to remove the container."]}),"\n",(0,o.jsx)(n.h3,{id:"using-docker-build-and-docker-run",children:"Using docker build and docker run"}),"\n",(0,o.jsxs)(n.p,{children:["You can also build the image and run the container in separate steps. Again, make sure that you have changed directory to the location of the ",(0,o.jsx)(n.code,{children:"Dockerfile"}),". Then issue the command:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sh",children:"   docker build -t foo .\n"})}),"\n",(0,o.jsxs)(n.p,{children:["This will create a Docker image with tag ",(0,o.jsx)(n.code,{children:"foo"}),". The tag is required to be all lower-case letters. By convention, we advise using the LF source file name, converted to lower case."]}),"\n",(0,o.jsx)(n.p,{children:"You can then use this tag to run the image in a container:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sh",children:"   docker run -t --rm foo\n"})}),"\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"-t"})," option creates a pseudo terminal, which is necessary for you to see any output produced by your program to ",(0,o.jsx)(n.code,{children:"stdout"}),". If your program also reads from ",(0,o.jsx)(n.code,{children:"stdin"}),", then you will need to give the ",(0,o.jsx)(n.code,{children:"-i"})," option as well, or combine the two as ",(0,o.jsx)(n.code,{children:"it"}),"."]}),"\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"--rm"})," option is important. This removes the container upon completion of the run. If you omit this option, the container will continue to exist even after your program has terminated. You can alternatively remove the container after the run using ",(0,o.jsx)(n.code,{children:"docker rm"}),"."]}),"\n",(0,o.jsxs)(n.p,{children:["If you wish for your program to run in the background, give a ",(0,o.jsx)(n.code,{children:"-d"}),' option as well (for "detached"). In this case, you will not see any output from your run.']}),"\n",(0,o.jsx)(n.p,{children:"The above run command can include any supported command-line arguments to the LF program. For example, to specify a logical timeout, you can do this:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sh",children:"    docker run -t --rm foo --timeout 20 sec\n"})}),"\n",(0,o.jsx)(n.h2,{id:"federated-execution",children:"Federated Execution"}),"\n",(0,o.jsxs)(n.p,{children:["Suppose your LF source file is ",(0,o.jsx)(n.code,{children:"src/Fed.lf"}),". When you run ",(0,o.jsx)(n.code,{children:"lfc"})," or use the IDE to generate code, a file called ",(0,o.jsx)(n.code,{children:"Dockerfile"})," is created for each federate alongside its sources. Just like in the unfederated case, a single ",(0,o.jsx)(n.code,{children:"docker-compose.yml"})," will appear in the ",(0,o.jsx)(n.code,{children:"src_gen/Fed"})," directory, see ",(0,o.jsx)(n.a,{href:"/docs/writing-reactors/a-first-reactor#structure-of-an-lf-project",children:"Structure of an LF project"})," for more info."]}),"\n",(0,o.jsx)(n.h3,{id:"using-docker-compose-up-1",children:"Using docker compose up"}),"\n",(0,o.jsxs)(n.p,{children:["Change directory to where the ",(0,o.jsx)(n.code,{children:"docker-compose.yml"})," is located, and simply run:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sh",children:"    docker compose up --build \n"})}),"\n",(0,o.jsxs)(n.p,{children:["This will build images for all the federates (and the RTI, which is pulled from ",(0,o.jsx)(n.a,{href:"https://hub.docker.com/r/lflang/rti",children:"Docker Hub"}),"), and run them on jointly on a shared network."]}),"\n",(0,o.jsx)(n.h3,{id:"using-docker-build-and-docker-run-1",children:"Using docker build and docker run"}),"\n",(0,o.jsx)(n.p,{children:"You can also build the images and run the containers in separate steps, for each container individually."}),"\n",(0,o.jsxs)(n.p,{children:["To build a particular federate that we assume is called ",(0,o.jsx)(n.code,{children:"foo"}),", change directory to ",(0,o.jsx)(n.code,{children:"src-gen/Fed/federate__foo"})," (there should be a ",(0,o.jsx)(n.code,{children:"Dockerfile"})," in this directory). Then issue the command:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sh",children:"   docker build -t foo .\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Assuming there is one more federate in the program that is called ",(0,o.jsx)(n.code,{children:"bar"}),", change directory to ",(0,o.jsx)(n.code,{children:"src-gen/Fed/federate__bar"})," and run:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sh",children:"   docker build -t bar .\n"})}),"\n",(0,o.jsx)(n.p,{children:"To pull the RTI from DockerHub, run this command:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sh",children:"   docker pull lflang/rti:rti\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Now, create a named network on which to run your federation. For example, to create a network named ",(0,o.jsx)(n.code,{children:"lf"}),", do this:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sh",children:"    docker network create lf\n"})}),"\n",(0,o.jsx)(n.p,{children:"You can then launch the RTI on this network (do this in a separate terminal):"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sh",children:"     docker run -t --rm --name rti --network lf lflang/rti:rti -n 2 -i 1234\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Here, the ",(0,o.jsx)(n.code,{children:"-n 2"})," indicates that the total number of federates is two and ",(0,o.jsx)(n.code,{children:"-i 1234"})," assigns an identifier for the federation."]}),"\n",(0,o.jsxs)(n.p,{children:["The federates ",(0,o.jsx)(n.code,{children:"foo"})," and ",(0,o.jsx)(n.code,{children:"bar"}),", the images of which have already been built, can be started using the following commands:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-sh",children:"docker run -t --rm --network lf foo\ndocker run -t --rm --network lf bar\n"})})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(l,{...e})}):l(e)}},28453:(e,n,r)=>{r.d(n,{R:()=>t,x:()=>s});var o=r(96540);const i={},c=o.createContext(i);function t(e){const n=o.useContext(c);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),o.createElement(c.Provider,{value:n},e.children)}}}]);