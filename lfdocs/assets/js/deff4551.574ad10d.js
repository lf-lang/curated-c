"use strict";(globalThis.webpackChunkdocusaurus_classic_typescript=globalThis.webpackChunkdocusaurus_classic_typescript||[]).push([[40021],{28453:(e,n,i)=>{i.d(n,{R:()=>t,x:()=>a});var r=i(96540);const o={},d=r.createContext(o);function t(e){const n=r.useContext(d);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:t(e.components),r.createElement(d.Provider,{value:n},e.children)}},81369:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>t,default:()=>h,frontMatter:()=>d,metadata:()=>a,toc:()=>s});var r=i(74848),o=i(28453);const d={title:"Arduino",description:"Developing LF Programs on Arduino."},t=void 0,a={id:"embedded/arduino",title:"Arduino",description:"Developing LF Programs on Arduino.",source:"@site/docs/embedded/arduino.mdx",sourceDirName:"embedded",slug:"/embedded/arduino",permalink:"/docs/next/embedded/arduino",draft:!1,unlisted:!1,editUrl:"https://github.com/lf-lang/lf-lang.github.io/tree/master/docs/embedded/arduino.mdx",tags:[],version:"current",frontMatter:{title:"Arduino",description:"Developing LF Programs on Arduino."},sidebar:"handbookSidebar",previous:{title:"Security",permalink:"/docs/next/reference/security"},next:{title:"Patmos",permalink:"/docs/next/embedded/patmos"}},l={},s=[{value:"Overview",id:"overview",level:2},{value:"Prerequisites",id:"prerequisites",level:3},{value:"Writing a simple Arduino Program",id:"writing-a-simple-arduino-program",level:2},{value:"Platform Options",id:"platform-options",level:3},{value:"Baud rate of the serial port",id:"baud-rate-of-the-serial-port",level:4},{value:"Building",id:"building",level:2},{value:"Flashing",id:"flashing",level:2}];function c(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsxs)(n.p,{children:["To run Lingua Franca on an Arduino-compatible microcontroller, you can use the\n",(0,r.jsx)(n.code,{children:"C"})," target with the ",(0,r.jsx)(n.code,{children:"platform"})," target property set to ",(0,r.jsx)(n.code,{children:"arduino"}),". The Lingua\nFranca compiler will then not output ordinary C code in a CMake project, but\ngenerate a ",(0,r.jsx)(n.code,{children:".ino"})," sketch that can be compiled and deployed using ",(0,r.jsx)(n.code,{children:"arduino-cli"}),".\nTo flash the compiled sketch onto a board, you need specify a Fully Qualified\nBoard Name (FQBN) as well as the port to which your board is connected. On this\npage, we explain exactly how to do this."]}),"\n",(0,r.jsx)(n.h3,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"You need a development system that runs on macOS or Linux (there is currently no Windows support)."}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://arduino.github.io/arduino-cli/",children:"Arduino CLI"})," must be installed on your development system. Confirm that your installation works by running:"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"arduino-cli version\n"})}),"\n",(0,r.jsx)(n.h2,{id:"writing-a-simple-arduino-program",children:"Writing a simple Arduino Program"}),"\n",(0,r.jsx)(n.p,{children:"The most basic Arduino program (Blink) can be defined in LF like so:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-lf",children:'target C {\n  platform: "Arduino"\n}\n\nmain reactor Blink {\n  timer t1(0, 1 sec)\n  timer t2(500 msec, 1 sec)\n  reaction(startup) {=\n    pinMode(LED_BUILTIN, OUTPUT);\n  =}\n\n  reaction (t1) {=\n    digitalWrite(LED_BUILTIN, HIGH);\n  =}\n\n  reaction (t2) {=\n    digitalWrite(LED_BUILTIN, LOW);\n  =}\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:["The key difference between writing ordinary Arduino code and writing LF code is\nthat there is no ",(0,r.jsx)(n.code,{children:"setup()"})," and ",(0,r.jsx)(n.code,{children:"loop()"})," function. In LF, execution is\nevent-driven, with reactive code being triggered by events, such as the\nexpiration of a timer. Those pieces of reactive code, specified as reactions,\ncan invoke Arduino library functions, just like one would do in the definition\nof an Arduino ",(0,r.jsx)(n.code,{children:"loop()"}),". For any setup that might be needed at the beginning of\nexecution, a reaction triggered by the built-in ",(0,r.jsx)(n.code,{children:"startup"})," trigger can be used."]}),"\n",(0,r.jsx)(n.h3,{id:"platform-options",children:"Platform Options"}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"platform"})," property can also be used so specify more details. Along with ",(0,r.jsx)(n.code,{children:'name: "arduino"'}),",\nyou can specify which ",(0,r.jsx)(n.code,{children:"board"}),", ",(0,r.jsx)(n.code,{children:"port"}),", and ",(0,r.jsx)(n.code,{children:"baud-rate"})," you are using. If you want the program\nto be flashed onto the board automatically after compilation, specify ",(0,r.jsx)(n.code,{children:"flash: true"}),".\nHere a target declaration that specifies all of these options:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-lf",children:'target C {\n  platform: {\n    name: "arduino",\n    board: "arduino:avr:uno",\n    port: "/dev/ttyd2",\n    baud-rate: 115200,\n    flash: true\n  }\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"board"})," is necessary for ",(0,r.jsx)(n.a,{href:"#building",children:"building"})," and the ",(0,r.jsx)(n.code,{children:"port"})," is necessary for ",(0,r.jsx)(n.a,{href:"#flashing",children:"flashing"}),"."]}),"\n",(0,r.jsx)(n.h4,{id:"baud-rate-of-the-serial-port",children:"Baud rate of the serial port"}),"\n",(0,r.jsxs)(n.p,{children:["All Arduino boards have at least one serial port (also known as a UART or\nUSART), and some have several. By default, Lingua Franca will assume a default\nbaud rate of 9600. This parameter is tunable by adjusting the ",(0,r.jsx)(n.code,{children:"baud-rate"}),"\nparameter in platform options."]}),"\n",(0,r.jsx)(n.h2,{id:"building",children:"Building"}),"\n",(0,r.jsxs)(n.p,{children:["In order to have ",(0,r.jsx)(n.code,{children:"arduino-cli"})," compile the generated sketch file, a ",(0,r.jsx)(n.code,{children:"board"})," must\nbe specified. If no ",(0,r.jsx)(n.code,{children:"board"})," is set, ",(0,r.jsx)(n.code,{children:"lfc"})," will run in ",(0,r.jsx)(n.code,{children:"no-compile"})," mode, meaning\nit will not invoke the target compiler. Whether specified as a target property\nor given directly to ",(0,r.jsx)(n.code,{children:"arduino-cli"}),", you need an FQBN. You can find the FQBN of\nthe board that you have plugged in using the following command:"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"arduino-cli board list"})}),"\n",(0,r.jsx)(n.p,{children:"To see the list of all FQBN's installed on your device (all FQBNs supported by the libraries you have installed), run the following command:"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"arduino-cli board listall"})}),"\n",(0,r.jsx)(n.p,{children:"You likely need to install support for your board first, which you can do using the following command:"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"arduino-cli core install arduino:[BOARD_FAMILY]"})}),"\n",(0,r.jsxs)(n.p,{children:["The common board families include ",(0,r.jsx)(n.code,{children:"avr"}),", ",(0,r.jsx)(n.code,{children:"megaAVR"}),", ",(0,r.jsx)(n.code,{children:"sam"}),", ",(0,r.jsx)(n.code,{children:"samd"}),", and ",(0,r.jsx)(n.code,{children:"mbed"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["If you specify your FQBN under ",(0,r.jsx)(n.code,{children:"board"})," in the ",(0,r.jsx)(n.code,{children:"platform"})," target property, ",(0,r.jsx)(n.code,{children:"lfc"})," will automatically invoke ",(0,r.jsx)(n.code,{children:"arduino-cli"})," on the generated sketch. To invoke ",(0,r.jsx)(n.code,{children:"arduino-cli"})," manually"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["for unthreaded programs (most arduino flavors), run:\n",(0,r.jsx)(n.code,{children:'arduino-cli compile -b [FQBN] --build-property compiler.c.extra_flags="-DLF_SINGLE_THREADED=1 -DPLATFORM_ARDUINO -DINITIAL_EVENT_QUEUE_SIZE=10 -DINITIAL_REACT_QUEUE_SIZE=10" --build-property compiler.cpp.extra_flags="-DLF_SINGLE_THREADED=1 -DPLATFORM_ARDUINO -DINITIAL_EVENT_QUEUE_SIZE=10 -DINITIAL_REACT_QUEUE_SIZE=10"'})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["for threaded programs (",(0,r.jsx)(n.code,{children:"arduino:mbed"})," boards), run:\n",(0,r.jsx)(n.code,{children:'arduino-cli compile -b [FQBN] --build-property compiler.c.extra_flags="-DPLATFORM_ARDUINO -DINITIAL_EVENT_QUEUE_SIZE=10 -DINITIAL_REACT_QUEUE_SIZE=10" --build-property compiler.cpp.extra_flags="-DPLATFORM_ARDUINO -DINITIAL_EVENT_QUEUE_SIZE=10 -DINITIAL_REACT_QUEUE_SIZE=10"'})]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"flashing",children:"Flashing"}),"\n",(0,r.jsx)(n.p,{children:"Arduino's can be flashed via USB. To find the port oto which your device is connected, run the following command:"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"arduino-cli board list"})}),"\n",(0,r.jsxs)(n.p,{children:["You can either use ",(0,r.jsx)(n.code,{children:"arduino-cli"})," to flash the code onto your device after the sketch file has been built, or you can set ",(0,r.jsx)(n.code,{children:"flash:true"})," and provide a ",(0,r.jsx)(n.code,{children:"port"})," in your Lingua Franca file. To flash manually using ",(0,r.jsx)(n.code,{children:"arduino-cli"}),", enter the subdirectory of ",(0,r.jsx)(n.code,{children:"src-gen"})," in which the generated sketch file is located and run:"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"arduino-cli upload -p PORT -b FQBN ."})})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}}}]);