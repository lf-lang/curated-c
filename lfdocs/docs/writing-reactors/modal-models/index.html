<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-0.11.0 docs-doc-page docs-doc-id-writing-reactors/modal-models" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.5.2">
<title data-rh="true">Modal Reactors | Lingua Franca</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://www.lf-lang.org/img/lf-social-card.png"><meta data-rh="true" name="twitter:image" content="https://www.lf-lang.org/img/lf-social-card.png"><meta data-rh="true" property="og:url" content="https://www.lf-lang.org/docs/writing-reactors/modal-models/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="0.11.0"><meta data-rh="true" name="docusaurus_tag" content="docs-default-0.11.0"><meta data-rh="true" name="docsearch:version" content="0.11.0"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-0.11.0"><meta data-rh="true" property="og:title" content="Modal Reactors | Lingua Franca"><meta data-rh="true" name="description" content="Modal Reactors"><meta data-rh="true" property="og:description" content="Modal Reactors"><link data-rh="true" rel="icon" href="../../../img/favicon.png"><link data-rh="true" rel="canonical" href="https://www.lf-lang.org/docs/writing-reactors/modal-models/"><link data-rh="true" rel="alternate" href="https://www.lf-lang.org/docs/writing-reactors/modal-models/" hreflang="en"><link data-rh="true" rel="alternate" href="https://www.lf-lang.org/docs/writing-reactors/modal-models/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://U5IWIJW31Z-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="../../../blog/rss.xml" title="Lingua Franca RSS Feed">
<link rel="alternate" type="application/atom+xml" href="../../../blog/atom.xml" title="Lingua Franca Atom Feed">



<link rel="search" type="application/opensearchdescription+xml" title="Lingua Franca" href="../../../opensearch.xml"><link rel="stylesheet" href="../../../assets/css/styles.ba30d6af.css">
<script src="../../../assets/js/runtime~main.cb523eb3.js" defer="defer"></script>
<script src="../../../assets/js/main.0ff8ee1b.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="../../../index.html"><div class="navbar__logo"><img src="../../../img/lf-forlight.svg" alt="The Lingua Franca Logo" class="lf-navbar-logo themedComponent_mlkZ themedComponent--light_NVdE"><img src="../../../img/lf-fordark.svg" alt="The Lingua Franca Logo" class="lf-navbar-logo themedComponent_mlkZ themedComponent--dark_xIcU"></div></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="../../index.html">Handbook</a><a class="navbar__item navbar__link" href="../../../blog/index.html">Blog</a><a class="navbar__item navbar__link" href="../../../research/index.html">Research</a><a class="navbar__item navbar__link" href="../../../community/index.html">Community</a><a class="navbar__item navbar__link" href="../../../events/index.html">Events</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="index.html">0.11.0</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="../../next/writing-reactors/modal-models/index.html">Nightly ðŸš§</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="index.html">0.11.0</a></li><li><a class="dropdown__link" href="../../0.10.0/writing-reactors/modal-models/index.html">0.10.0</a></li><li><a class="dropdown__link" href="../../0.9.0/writing-reactors/modal-models/index.html">0.9.0</a></li><li><a class="dropdown__link" href="../../0.8.0/writing-reactors/modal-models/index.html">0.8.0</a></li><li><a class="dropdown__link" href="../../0.7.0/writing-reactors/modal-models/index.html">0.7.0</a></li><li><a class="dropdown__link" href="../../0.6.0/writing-reactors/modal-models/index.html">0.6.0</a></li><li><a class="dropdown__link" href="../../0.5.0/writing-reactors/modal-models/index.html">0.5.0</a></li></ul></div><a href="https://github.com/lf-lang/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="../../index.html">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="../../installation/index.html">Installation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="../../videos/index.html">Videos</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="../a-first-reactor/index.html">Writing Reactors</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="../a-first-reactor/index.html">A First Reactor</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="../inputs-and-outputs/index.html">Inputs and Outputs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="../parameters-and-state-variables/index.html">Parameters and State Variables</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="../time-and-timers/index.html">Time and Timers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="../composing-reactors/index.html">Composing Reactors</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="../reactions/index.html">Reactions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="../reaction-declarations/index.html">Reaction Declarations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="../methods/index.html">Methods</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="../causality-loops/index.html">Causality Loops</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="../extending-reactors/index.html">Extending Reactors</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="../actions/index.html">Actions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="../superdense-time/index.html">Superdense Time</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="index.html">Modal Reactors</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="../deadlines/index.html">Deadlines</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="../multiports-and-banks/index.html">Multiports and Banks</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="../generics/index.html">Generic Reactors</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="../preambles/index.html">Preambles</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="../distributed-execution/index.html">Distributed Execution</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="../termination/index.html">Termination</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="../../tools/code-extension/index.html">Tools</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="../../reference/docker-support/index.html">Reference</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="../../embedded/arduino/index.html">Embedded Platforms</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="../../developer/contributing/index.html">Developer</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="../../glossary/index.html">Glossary</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="../../../index.html"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Writing Reactors</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Modal Reactors</span><meta itemprop="position" content="2"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: 0.11.0</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Modal Reactors</h1></header><p>This article has examples in the following target languages:</p><div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">C</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Python</li></ul><div class="margin-top--md"></div></div>
<p>The basic idea of <em>modal reactors</em> is to partition a reactor into disjoint subsets of reactions (or other components) that are associated with mutually exclusive <em>modes</em>.
In a modal reactor, only a single mode can be active at a particular logical time instant, meaning that activity in other modes is automatically suspended.
Transitioning between modes switches the reactor&#x27;s behavior and provides control over continuing or resetting the previous history of the entered mode.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="syntax">Syntax<a href="#syntax" class="hash-link" aria-label="Direct link to Syntax" title="Direct link to Syntax">â€‹</a></h2>
<p>Modes can be defined in any reactor, except federated ones.
Each mode requires a unique (per reactor) name and can declare contents that are local to this mode.
There must be exactly one mode marked as <code>initial</code>.</p>
<pre class="shiki"><code>reactor TwoModes {
  ...
  initial mode One {
    ...
  }
  mode Two {
    ...
  }
}
</code></pre>
<p>A mode can contain local state variables, timers, actions, reactions, reactor instantiations, and connections.
While modes cannot be nested in modes directly, hierarchical composition is possible through the instantiation of modal reactors.
The main exception in allowed contents in modes are port declarations, as these are only possible on reactor level.
Yet, modes share the scope with their reactor and, hence, can access ports, state variables, and parameters of the reactor.
Only the contents of other modes are excluded.
A modal reactor can still have reactions, reactor instantiations, etc., that are not located in modes and will consequently be executed independently from mode activity.</p>
<p>Mode transitions are declared within reactions.
If a reactor has modes, reactions inside modes are allowed to list them as effects.
Such an effect enables the use of the target language API to set the next mode.</p>
<div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP hidden_PYVj tabs__item--active">c</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP hidden_PYVj">py</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><pre class="shiki"><code>reaction(trig) -&gt; Two {=
  if (trig-&gt;value) {
    lf_set_mode(Two)
  }
=}
</code></pre></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><pre class="shiki"><code>reaction(trig) -&gt; Two {=
  if trig.value:
    Two.set()
=}
</code></pre></div></div></div>
<p>You can also specify the type of the transition by adding the modifier <code>reset(mode)</code> or <code>history(mode)</code> in the effects of the
reaction signature (i.e., after the <code>-&gt;</code>). For example, a history transition to the state <code>Two</code> is enabled by listing <code>history(Two)</code>
among the effects of the reaction. The <code>reset</code> variant is implicitly assumed when the mode is listed without modifier.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="execution-semantics">Execution Semantics<a href="#execution-semantics" class="hash-link" aria-label="Direct link to Execution Semantics" title="Direct link to Execution Semantics">â€‹</a></h2>
<p>The basic effect of modes is that only parts that are contained in the currently active mode (or outside any mode) are executed at any point in time.
This also holds for parts that are nested in multiple <em>ancestor modes</em> due to hierarchy; consequently, all those ancestors must be active in order to execute.
Reactions in inactive modes are simply not executed, while all components that model timing behavior, namely timers, scheduled actions, and delayed connections, are subject to a concept of <em>local time</em>.
That means while a mode is inactive, the progress of time is suspended locally.
How the timing components behave when a mode becomes active depends on the transition type.
A mode can be <em>reset</em> upon entry, returning it to its initial state.
Alternatively, it may be entered preserving its <em>history</em>, which only has an actual effect if the mode was active before.
In the latter case all timing components will continue their delays or period as if no time had passed during inactivity of the mode.
The following section will provide a more detailed explanation of this effect.</p>
<p>Upon reactor startup, the initial mode of each modal reactor is active, others are inactive.
If at a tag <em>(t, m)</em>, all reactions of this reactor and all its contents have finished executing, and a new mode was set in a reaction, the current mode will be deactivated and the new one will be activated for future execution.
This means no reaction of the newly active mode will execute at tag <em>(t, m)</em>; the earliest possible reaction in the new mode occurs one microstep later, at <em>(t, m+1)</em>.
Hence, if the newly active mode has for example a timer that will elapse with an offset of zero, it will trigger at <em>(t, m+1)</em>.
In case the mode itself does not require an immediate execution in the next microstep, it depends on future events, just as in the normal behavior of LF.
Hence, modes in the same reactor are always mutually exclusive w.r.t. superdense time.</p>
<p>A transition is triggered if a new mode is set in a reaction body.
As with setting output ports in reaction, a new mode can be set multiple times in the same or different reactions.
In the end, the fixed ordering of reactions determines the last effective value that will be used.
The new mode does not have to be a different one; it is possible for a mode to reset itself via a reset transition.</p>
<p>In case a mode is entered with the reset behavior:</p>
<ul>
<li>all contained modal reactors are reset to their initial mode (recursively),</li>
<li>all contained timers are reset and start again awaiting their initial offset,</li>
<li>all contained state variables that are marked for automatic reset are reset to their initial value,</li>
<li>any contained reactions triggered by <code>reset</code> are executed, and</li>
<li>all events (actions, timers, delayed connections) that were previously scheduled from within this mode are discarded.</li>
</ul>
<p>Note that <em>contained</em> refers to all contents defined locally in the mode and in local reactor instances (recursively) that are not otherwise enclosed in modes of lower levels.</p>
<p>Whenever a mode is entered with a reset transition, the subsequent timing behavior is as if the mode was never executed before.
If there are state variables that need to be reset or reinitialized, then this can be done in a reaction triggered by <code>reset</code> or by marking the state variable for automatic reset (e.g., <span><code>reset state x:int(0)</code></span><span class="hidden_PYVj"><code>reset state x(0)</code></span>).</p>
<p>State variables are not reset automatically to their initial conditions because it is idiomatic for reactors to allocate resources or initialize subsystems (e.g., allocate memory or sockets, register an interrupt, or start a server) in reactions triggered by the <code>startup</code>, and to store references to these resources in state variables.
If these were to be automatically reset, those references would be lost.</p>
<p>On the other hand, if a mode has been active prior and is then re-entered via a <code>history</code> transition, no reset is performed.
Events originating from timers, scheduled actions, and delayed connections are adjusted to reflect a remaining delay equal to the remaining delay recorded at the instant the mode was previously deactivated.
As a consequence, a mode has a notion of local time that elapses only when the mode is active.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="local-time">Local Time<a href="#local-time" class="hash-link" aria-label="Direct link to Local Time" title="Direct link to Local Time">â€‹</a></h3>
<p>From the perspective of timers and actions, time is suspended when a mode is inactive.
This also applies to indirectly nested reactors within modes and connections with logical delays, if their source lies within a mode.</p>
<!-- -->
<local_timesvg title="Illustration of local time (model): local_time"></local_timesvg>
<p>The above LF model illustrates the different characteristics of local time affecting timers and actions in the presence of the two transition types.</p>
<p>It consists of two modes <code>One</code> (the initial mode) and <code>Two</code>, both in the <code>Modal</code> reactor.
The <code>next</code> input toggles between these modes and is controlled by a reaction at the top level that is triggered by the timer <code>T</code>.
After one second, a mode switch is triggered periodically with a period one second.
Each mode has a timer <code>T1</code>/<code>T2</code> that triggers a reaction after an initial offset of 100 msec and then periodically after 750 msec.
This reaction then schedules a logical action with a delay of 500 msec (the actual target code does not add an additional delay over the minimum specified).
This action triggers the second reaction, which writes to the output <code>out</code>.
The main difference between the modes is that <code>One</code> is entered via a history transition, continuing its behavior, while <code>Two</code> is reset.
(History behavior is indicated by an &quot;H&quot; on the transition edge because it enters into the entire history of the mode.)</p>
<!-- -->
<local_time_tracesvg title="Illustration of local time (trace): local_time_trace"></local_time_tracesvg>
<p>Above is the execution trace of the first 4 seconds of this program.
Below the timeline is the currently active mode and above the timeline are the model elements that are executed at certain points in time, together with indicating triggering and their relation through time.
For example, at 100 msec, the initial offset of timer <code>T1</code> elapses, which leads to the scheduling of the logical action in this mode.
The action triggers the reaction 500 msec later, at 600 msec, and thus causes an output.
The timing diagram illustrates the different handling of time between history transitions and reset transitions.
Specifically, when mode <code>One</code> is re-entered via a history transition, at time 2000 msec, the action triggered by <code>T1</code> before, at time 850 msec, resumes.
In contrast, when mode <code>Two</code> is re-entered via a reset transition, at time 3000 msec, the action triggered by <code>T2</code> before, at time 1850 msec, gets discarded.</p>
<!-- -->
<local_time_plotsvg title="Illustration of local time (plot): local_time_plot"></local_time_plotsvg>
<p>The above plot illustrates the relation between global time in the environment and the localized time for each timer in the model.
Since the top-level reactor <code>TimingExample</code> is not enclosed by any mode, its time always corresponds to the global time.
Mode <code>One</code> is the initial mode and hence progresses in sync with <code>TimingExample</code> for the first second.
During inactivity of mode One the timer is suspended and does not advance in time.
At 2000 msec it continues relative to this time.
<code>T2</code> only starts advancing when the mode becomes active at 1000 msec.
The reentry via reset at 3000 msec causes the local time to be reset to zero.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="startup-and-shutdown">Startup and Shutdown<a href="#startup-and-shutdown" class="hash-link" aria-label="Direct link to Startup and Shutdown" title="Direct link to Startup and Shutdown">â€‹</a></h3>
<p>A challenge for modal execution is the handling <code>startup</code> and <code>shutdown</code> behavior.
These are commonly used for managing memory for state variables, handling connections to sensors or actuators, or starting/joining external threads.
If reactions to these triggers are located inside modes they are subject to a special execution regime.</p>
<p>First, <code>startup</code> reactions are invoked at most once at the first activation of a mode.
Second, <code>shutdown</code> reactions are executed when the reactor shuts down, <strong><em>irrespective</em></strong> of mode activity, but only if the enclosing modes have been activated at least once.
Hence, every startup has a corresponding shutdown.
Third, as mentioned before, the new <code>reset</code> trigger for reactions can be used, if a startup behavior should be re-executed if a mode is entered with a reset transition.</p>
<p>Note that this may have unexpected implications:</p>
<ul>
<li>Startup behavior inside modes may occur during execution and not only at program start.</li>
<li>Multiple shutdown reactions may be executed, bypassing mutual exclusion of modes.</li>
<li>Reactors that are designed without consideration of modes and use only <code>startup</code> (not <code>reset</code>) to trigger an execution chain, may not work in modes and cease to function if re-entered with a reset.</li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/lf-lang/lf-lang.github.io/tree/master/versioned_docs/version-0.11.0/writing-reactors/modal-models.mdx" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="../superdense-time/index.html"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Superdense Time</div></a><a class="pagination-nav__link pagination-nav__link--next" href="../deadlines/index.html"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Deadlines</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#syntax" class="table-of-contents__link toc-highlight">Syntax</a></li><li><a href="#execution-semantics" class="table-of-contents__link toc-highlight">Execution Semantics</a><ul><li><a href="#local-time" class="table-of-contents__link toc-highlight">Local Time</a></li><li><a href="#startup-and-shutdown" class="table-of-contents__link toc-highlight">Startup and Shutdown</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://zulip.lf-lang.org" target="_blank" rel="noopener noreferrer" class="footer__link-item">Zulip<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="../../../blog/index.html">Blog</a></li><li class="footer__item"><a href="https://github.com/lf-lang" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2026 The Lingua Franca project. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>