<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.5.2">
<title data-rh="true">Decentralized Consistency | Lingua Franca</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://www.lf-lang.org/img/lf-social-card.png"><meta data-rh="true" name="twitter:image" content="https://www.lf-lang.org/img/lf-social-card.png"><meta data-rh="true" property="og:url" content="https://www.lf-lang.org/blog/decentralized-consistency/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Decentralized Consistency | Lingua Franca"><meta data-rh="true" name="description" content="The design of distributed applications in Lingua Franca requires care, particularly if the coordination of the federation is decentralized. The intent of this post is to illustrate and handle the challenges arising from designing distributed applications in Lingua Franca, with the help of two realistic use cases."><meta data-rh="true" property="og:description" content="The design of distributed applications in Lingua Franca requires care, particularly if the coordination of the federation is decentralized. The intent of this post is to illustrate and handle the challenges arising from designing distributed applications in Lingua Franca, with the help of two realistic use cases."><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2025-10-14T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://dblp.org/pid/347/8232.html,http://people.eecs.berkeley.edu/~eal/,https://www.linkedin.com/in/ravicakella/"><meta data-rh="true" property="article:tag" content="lingua franca,federation,decentralized,consistency,maxwait"><link data-rh="true" rel="icon" href="../../img/favicon.png"><link data-rh="true" rel="canonical" href="https://www.lf-lang.org/blog/decentralized-consistency/"><link data-rh="true" rel="alternate" href="https://www.lf-lang.org/blog/decentralized-consistency/" hreflang="en"><link data-rh="true" rel="alternate" href="https://www.lf-lang.org/blog/decentralized-consistency/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://U5IWIJW31Z-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"https://www.lf-lang.org/blog/decentralized-consistency","mainEntityOfPage":"https://www.lf-lang.org/blog/decentralized-consistency","url":"https://www.lf-lang.org/blog/decentralized-consistency","headline":"Decentralized Consistency","name":"Decentralized Consistency","description":"The design of distributed applications in Lingua Franca requires care, particularly if the coordination of the federation is decentralized. The intent of this post is to illustrate and handle the challenges arising from designing distributed applications in Lingua Franca, with the help of two realistic use cases.","datePublished":"2025-10-14T00:00:00.000Z","author":[{"@type":"Person","name":"Francesco Paladino","description":"Postdoc, UC Berkeley","url":"https://dblp.org/pid/347/8232.html","image":"https://avatars.githubusercontent.com/u/47446988?v=4"},{"@type":"Person","name":"Edward A. Lee","description":"Professor at UC Berkeley","url":"http://people.eecs.berkeley.edu/~eal/","image":"https://avatars.githubusercontent.com/u/8513334?v=4"},{"@type":"Person","name":"Ravi Akella","description":"Sr. Research Engineer, DENSO International America Inc.","url":"https://www.linkedin.com/in/ravicakella/","image":"https://avatars.githubusercontent.com/u/913550?v=4"}],"keywords":[],"isPartOf":{"@type":"Blog","@id":"https://www.lf-lang.org/blog","name":"Blog"}}</script><link rel="alternate" type="application/rss+xml" href="../rss.xml" title="Lingua Franca RSS Feed">
<link rel="alternate" type="application/atom+xml" href="../atom.xml" title="Lingua Franca Atom Feed">



<link rel="search" type="application/opensearchdescription+xml" title="Lingua Franca" href="../../opensearch.xml"><link rel="stylesheet" href="../../assets/css/styles.ba30d6af.css">
<script src="../../assets/js/runtime~main.cb523eb3.js" defer="defer"></script>
<script src="../../assets/js/main.0ff8ee1b.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="../../index.html"><div class="navbar__logo"><img src="../../img/lf-forlight.svg" alt="The Lingua Franca Logo" class="lf-navbar-logo themedComponent_mlkZ themedComponent--light_NVdE"><img src="../../img/lf-fordark.svg" alt="The Lingua Franca Logo" class="lf-navbar-logo themedComponent_mlkZ themedComponent--dark_xIcU"></div></a><a class="navbar__item navbar__link" href="../../docs/index.html">Handbook</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="../index.html">Blog</a><a class="navbar__item navbar__link" href="../../research/index.html">Research</a><a class="navbar__item navbar__link" href="../../community/index.html">Community</a><a class="navbar__item navbar__link" href="../../events/index.html">Events</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="../../docs/index.html">0.11.0</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="../../docs/next/index.html">Nightly ðŸš§</a></li><li><a class="dropdown__link" href="../../docs/index.html">0.11.0</a></li><li><a class="dropdown__link" href="../../docs/0.10.0">0.10.0</a></li><li><a class="dropdown__link" href="../../docs/0.9.0">0.9.0</a></li><li><a class="dropdown__link" href="../../docs/0.8.0">0.8.0</a></li><li><a class="dropdown__link" href="../../docs/0.7.0">0.7.0</a></li><li><a class="dropdown__link" href="../../docs/0.6.0">0.6.0</a></li><li><a class="dropdown__link" href="../../docs/0.5.0">0.5.0</a></li></ul></div><a href="https://github.com/lf-lang/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><div role="group"><h3 class="yearGroupHeading_rMGB">2025</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="index.html">Decentralized Consistency</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="../deadlines/index.html">Working with Deadlines</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_rMGB">2023</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="../lingo/index.html">The Lingo Package Manager</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="../docusaurus/index.html">New Lingua Franca Website</a></li></ul></div></nav></aside><main class="col col--7"><article><header><h1 class="title_f1Hy">Decentralized Consistency</h1><div class="container_mt6G margin-vert--md"><time datetime="2025-10-14T00:00:00.000Z">October 14, 2025</time> Â· <!-- -->14 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://dblp.org/pid/347/8232.html" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo authorImage_XqGP" src="https://avatars.githubusercontent.com/u/47446988?v=4" alt="Francesco Paladino"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="https://dblp.org/pid/347/8232.html" target="_blank" rel="noopener noreferrer"><span class="authorName_yefp">Francesco Paladino</span></a></div><small class="authorTitle_nd0D" title="Postdoc, UC Berkeley">Postdoc, UC Berkeley</small><div class="authorSocials_rSDt"></div></div></div></div><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="http://people.eecs.berkeley.edu/~eal/" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo authorImage_XqGP" src="https://avatars.githubusercontent.com/u/8513334?v=4" alt="Edward A. Lee"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="http://people.eecs.berkeley.edu/~eal/" target="_blank" rel="noopener noreferrer"><span class="authorName_yefp">Edward A. Lee</span></a></div><small class="authorTitle_nd0D" title="Professor at UC Berkeley">Professor at UC Berkeley</small><div class="authorSocials_rSDt"></div></div></div></div><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://www.linkedin.com/in/ravicakella/" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo authorImage_XqGP" src="https://avatars.githubusercontent.com/u/913550?v=4" alt="Ravi Akella"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="https://www.linkedin.com/in/ravicakella/" target="_blank" rel="noopener noreferrer"><span class="authorName_yefp">Ravi Akella</span></a></div><small class="authorTitle_nd0D" title="Sr. Research Engineer, DENSO International America Inc.">Sr. Research Engineer, DENSO International America Inc.</small><div class="authorSocials_rSDt"></div></div></div></div></div></header><div id="__blog-post-container" class="markdown"><p>The design of <a href="../../docs/writing-reactors/distributed-execution/index.html">distributed applications</a> in Lingua Franca requires care, particularly if the coordination of the federation is <a href="/docs/writing-reactors/distributed-execution/#decentralized-coordination">decentralized</a>. The intent of this post is to illustrate and handle the challenges arising from designing distributed applications in Lingua Franca, with the help of two realistic use cases.</p>
<!-- -->
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="indefinite-wait-for-inputs-aircraft-door-use-case">Indefinite wait for inputs: aircraft door use case<a href="#indefinite-wait-for-inputs-aircraft-door-use-case" class="hash-link" aria-label="Direct link to Indefinite wait for inputs: aircraft door use case" title="Direct link to Indefinite wait for inputs: aircraft door use case">â€‹</a></h2>
<p>Aircraft doors on passenger flights are currently managed manually by flight attendants.
Before takeoff, the flight attendants <em>arm</em> the door; if the door is opened in this state, an evacuation slide is automatically inflated and deployed for emergency evacuation.
When the aircraft is at a gate, before opening the door, the flight attendants <em>disarm</em> it to avoid the deployment of the evacuation slide.
Flight attendants are allowed to disarm the door <em>only</em> when they see through the porthole the ramp that will allow the passengers to disembark the aircraft.</p>
<p><img decoding="async" loading="lazy" alt="AircraftDoor diagram" src="../../assets/images/AircraftDoor-db4cdc2f3abf2013b63db4d1c7201e83.svg" width="559" height="128" class="img_ev3q"></p>
<p>Consider the above Lingua Franca program that implements a simplified system to remotely open an aircraft door that is in the <em>armed</em> state.
The door implements two independent remote services, door <em>disarming</em> and door <em>opening</em>, encoded by two different reactions in the <code>Door</code> reactor.
Suppose the pilot in the cockpit issues a command to open the door.
We would also like to automate the disarming of the door using a camera to verify the presence of a ramp. When the camera determines that the ramp is present, it triggers the disarming service. The camera detection is triggered by the door open command issued from the cockpit.</p>
<p>There are different ways to design and refactor the above system, for example, by removing the direct connection between the <code>Cockpit</code> and <code>Door</code> reactors. Our design choice is meant to highlight that door <em>disarming</em> and <em>opening</em> are two different and independent remote services triggered by two different commands issued by two different system actors. Therefore, each actor has an independent connection to the door to request its service.</p>
<p>The purpose of the system is to open the door in reaction to the command from the cockpit whether or not a ramp is present. If a ramp is present, it is imperative that the door be disarmed <em>before</em> being opened. Hence, the door, upon receiving the <code>open</code> command from the cockpit, should wait for input from the camera before opening.</p>
<p>The order in which messages are processed is crucial in this application. When the <em>disarm</em> and <em>open</em> commands arrive with the same tag, the <em>disarm</em> service needs to be invoked before opening the door, otherwise the escape slide will be erroneously deployed.
Lingua Franca guarantees determinism in the execution order of reactions with logically simultaneous inputs, and the order is given by the the order of declaration of the reactions inside the reactor. It is then sufficient to declare the <code>disarm</code> reaction <em>before</em> the <code>open</code> one. The diagram confirms the execution order by labeling the <code>disarm</code> reaction with 1 and the <code>open</code> reaction with 2.</p>
<p>The problem is that even though the messages are <em>logically</em> simultaneous, they do not arrive at the same <em>physical</em> time. In fact, the <code>open</code> command from the cockpit is likely to arrive before the clearance from the camera because the camera realizes an expensive computer vision algorithm. The door, consequently, has to wait for both inputs before invoking the <em>opening</em> service.</p>
<p>This is an example of an application that cannot safely proceed without assurance on its inputs. The following section explains how to obtain the desired behavior in Lingua Franca using the decentralized coordinator (the centralized coordinator automatically provides the required assurance).</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="consistency-with-decentralized-coordination">Consistency with decentralized coordination<a href="#consistency-with-decentralized-coordination" class="hash-link" aria-label="Direct link to Consistency with decentralized coordination" title="Direct link to Consistency with decentralized coordination">â€‹</a></h3>
<p>The application is implemented as a federated program with decentralized coordination, which means that the advancement of logical time in each single federate is not subject to approval from any centralized entities, but it is done locally based on the input it receives from the other federates and on its local physical clock.</p>
<p>Let us consider the case when the <code>Door</code> reactor receives the <em>open</em> command from the <code>Cockpit</code> reactor, but not yet the <em>disarm</em> command from the <code>Camera</code> reactor. As previously observed, the <code>Door</code> cannot proceed to invoke the <em>opening</em> service, because it needs to wait for the <code>Camera</code> to send the <em>disarm</em> command.
But how long should it wait?</p>
<p>The decentralized coordinator in
Lingua Franca allows you to customize this waiting time. Each federate can be assigned an attribute called <a href="/docs/writing-reactors/distributed-execution/#safe-to-advance-sta"><code>maxwait</code></a> that controls how long the federate should wait for inputs from other federates before processing an event, such as an input it has just received.
More precisely, <code>maxwait</code> is the maximum amount of time a federate waits before advancing its logical time to some value <em>t</em>. Specifically, to advance to logical time <em>t</em>, the federate waits until either all inputs are known up to an including time <em>t</em> or its local physical clock exceeds <em>t</em> +<code>maxwait</code>.
An input is known up to an including time <em>t</em> if a message with timestamp <em>t</em> or greater has been received on that input port.
At the expiration of the <code>maxwait</code>, the federate assumes that any unresolved ports will not receive any messages with timestamps <em>t</em> or earlier.
It can then advance its logical time to <em>t</em>.</p>
<p>In our example, we want the door to <em>wait indefinitely</em> for both <em>disarm</em> and <em>open</em> commands to arrive before processing any of them. In Lingua Franca, this is obtained by setting <code>maxwait</code> to <code>forever</code>. The <code>Door</code> reactor cannot safely proceed without assurance about the inputs.</p>
<p>The implementation of the <code>Door</code> reactor and its instantiation are shown below:</p>
<pre class="shiki"><code>reactor Door {
  input open: bool
  input disarm: bool
  state isDisarmed: bool = false
  state isOpen: bool = false

  reaction(disarm) {=
    if (disarm-&gt;value) {
      self-&gt;isDisarmed = true;
      printf(&quot;Door disarmed\n&quot;);
    } else {
      self-&gt;isDisarmed = false;
      printf(&quot;Door armed\n&quot;);
    }
  =} tardy {=
    printf(&quot;STP violation\n&quot;);
    printf(&quot;Intended tag: %lld\n&quot;, disarm-&gt;intended_tag);
    printf(&quot;Current tag: %lld\n&quot;, lf_time_logical());
  =}

  reaction(open) {=
    if (open-&gt;value) {
      self-&gt;open = true;
      printf(&quot;Door open\n&quot;);
    } else {
      self-&gt;open = false;
      printf(&quot;Door closed\n&quot;);
    }
  =} tardy {=
    printf(&quot;STP violation\n&quot;);
    printf(&quot;Intended tag: %lld\n&quot;, disarm-&gt;intended_tag);
    printf(&quot;Current tag: %lld\n&quot;, lf_time_logical());
  =}
}

federated reactor {
  c = new Cockpit()
  v = new Camera()
  
  @maxwait(forever)
  d = new Door()

  c.open -&gt; d.open
  c.open -&gt; v.check_ramp
  v.ramp_present -&gt; d.disarm
}
</code></pre>
<p>The <code>maxwait</code> attribute is specified at instantiation time within the main reactor. Right before creating the instance of the <code>Door</code> reactor for which we want to set the attribute, we use the <code>@maxwait</code> annotation that takes as input the <code>maxwait</code> value.</p>
<p>The reactions of the <code>Door</code> reactor provide <a href="/docs/writing-reactors/distributed-execution/#safe-to-process-stp-violation-handling">fault handlers</a> that are invoked in case the federate assumed inputs were known up to timestamp <em>t</em> and then later received a message with timestamp <em>t</em> or less. When <code>maxwait</code> is <code>forever</code>, these fault handlers should never be invoked.</p>
<p>For finite values of <code>maxwait</code>, it is always possible for messages to get sufficiently delayed that the fault handlers will be invoked.
When they are invoked, the current tag will be greater than the intended tag of the message.
This type of fault is called a <strong>safe-to-process</strong> (<strong>STP</strong>) violation because messages are being handled out of tag order.
The intended tag of the input can be accessed as shown in the code above.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="multirate-inputs-automatic-emergency-braking">Multirate inputs: automatic emergency braking<a href="#multirate-inputs-automatic-emergency-braking" class="hash-link" aria-label="Direct link to Multirate inputs: automatic emergency braking" title="Direct link to Multirate inputs: automatic emergency braking">â€‹</a></h2>
<p><img decoding="async" loading="lazy" alt="AutomaticEmergencyBrakingSystem diagram" src="../../assets/images/AutomaticEmergencyBrakingSystem-c4e7a155519baf77598fc57b9f4aae04.svg" width="933" height="354" class="img_ev3q"></p>
<p>Consider the above Lingua Franca implementation of an automatic emergency braking system, one of the most critical ADAS systems that modern cars are equipped with.
The controller system modeled by the <code>AutomaticEmergencyBraking</code> reactor reads data coming from two sensors, a lidar and a radar, and uses both to detect objects or pedestrians that cross the trajectory the car.
This is a <em>sensor fusion</em> problem, where a diversity of sensors is used to get better reliability.
When one of the two sensors signals the presence of an object at a distance shorter than a configurable threshold, the controller triggers the brake to stop the car and avoid crashing into it.</p>
<p>The sensors are modeled with their own timer that triggers the generation of data. The clocks of all federates are automatically synchronized by the <a href="/docs/writing-reactors/distributed-execution/#clock-synchronization">clock synchronization algorithm</a> of the Lingua Franca runtime (unless this is disabled).
Typically, in a real use case of this kind, the clock of sensor devices cannot be controlled by Lingua Franca, but a way to work around this limitation is to resample the data collected by sensors with the timing given by a clock that the runtime can control.
The sensor reactors of our application are then modeling this resampling of sensor data so that alignment of data from the two sensors is well defined and sensor fusion becomes possible.</p>
<p>The lidar sensor has a sampling frequency that is twice that of the radar, as indicated by the timers in the corresponding reactors; the lidar timer has a period of 50ms, while that of the radar 100ms.
Their deadline is equal to their period and is enforced using the dedicated <code>DeadlineCheck</code> reactors, following the guidelines of how to <a href="../deadlines/index.html">work with deadlines</a>.</p>
<p>The sensor behavior in the application can be simulated for testing purposes in a way that each sensor constantly produces distance values above the threshold (i.e., no objects in the way), and then at a random time it sends a distance value below the threshold, indicating the presence of a close object. When the <code>AutomaticEmergencyBraking</code> reactor receives that message, it signals the <code>BrakingSystem</code> reactor to brake the car, and the whole system shuts down.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="desired-system-properties">Desired system properties<a href="#desired-system-properties" class="hash-link" aria-label="Direct link to Desired system properties" title="Direct link to Desired system properties">â€‹</a></h3>
<p>Availability is a crucial property of this application, because we want the automatic emergency braking system to brake as fast as possible when a close object is detected. Consistency is also necessary, as sensor fusion happens with sensor data produced at the same logical time. Even if this is not implemented in our simplified example, sensor fusion in a more general scenario helps rule out false positives, i.e., cases in which one of the sensors erroneously detects a close object that would induce an unnecessary and dangerous braking. False positives are caused by the weaknesses of the specific sensor. For example, rainy or foggy weather reduces the accuracy of lidar sensors. The key concept is to gather data produced at the same logical time by all sensors and combine them to have a more accurate estimate of possible collisions. Consistency and in-order data processing are then required.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="consistency-challenge">Consistency challenge<a href="#consistency-challenge" class="hash-link" aria-label="Direct link to Consistency challenge" title="Direct link to Consistency challenge">â€‹</a></h4>
<p>The application is once agin implemented as a federated program with decentralized coordination.
Consistency problems may arise when a federate receives data from two or more federates, as it is the case of the <code>AutomaticEmergencyBraking</code> reactor.
The controller expects to receive input from both sensors at times 0ms, 100ms, 200ms, etc. Let&#x27;s consider as an example the case where the remote connection between the controller and the radar has a slightly larger delay than that between the controller and the lidar. The lidar input will then always arrive slightly earlier than the radar one. When the controller receives the lidar input, should it process the data immediately, or should it wait for the radar input to come? Sensor fusion requires consistency: if the controller processes the input from the lidar and then the radar data comes, the control action elaborated upon the arrival of the lidar data does not take into account both sensors, even though it should. Hence, in our use case, the <code>AutomaticEmergencyBraking</code> reactor needs to wait for both inputs before processing new data.</p>
<p>In our application, if we aim to process all incoming data with the same logical time to realize sensor fusion, then we can set <code>maxwait = forever</code> to <em>wait indefinitely</em> for the radar input before processing the radar.
Note that this might not be a good choice in this example because if a fault causes one of the sensors to stop sending messages, the ADAS system will stop working.
Hence, in practice, we will probably want a smaller value for <code>maxwait</code>, and we will want to add fault detection and mitigation to the application.
Fault handling will be addressed in a later blog. Here we assume no such faults.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="availability-challenge">Availability challenge<a href="#availability-challenge" class="hash-link" aria-label="Direct link to Availability challenge" title="Direct link to Availability challenge">â€‹</a></h4>
<p>Even without faults, however, setting <code>maxwait</code> to <code>forever</code> creates problems when only the lidar input is expected (50ms, 150ms, 250ms, etc): the controller cannot process that input until an input from the radar comes, because <code>maxwait</code> will never expire. For example, if the single lidar input comes at time 50ms, it has to wait until time 100ms before being processed. If that input was signaling the presence of a close object, the detection would be delayed by 50ms, which may potentially mean crashing into the object. The automatic emergency braking system must be available, otherwise it might not brake in time to avoid collisions.
The ideal <code>maxwait</code> value for maximum availability in the time instants with only the lidar input is 0, because if a single input is expected, no wait is necessary.</p>
<p>Summing up, consistency for sensor fusion requires <code>maxwait = forever</code> when inputs from both sensors are expected (or some finite value for fault tolerance), while availability calls for <code>maxwait = 0</code> when only the lidar input is coming. The two values are at odds, and any value in between would mean sacrificing both properties at the same time.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="dynamic-adjustment-of-maxwait">Dynamic adjustment of <code>maxwait</code><a href="#dynamic-adjustment-of-maxwait" class="hash-link" aria-label="Direct link to dynamic-adjustment-of-maxwait" title="Direct link to dynamic-adjustment-of-maxwait">â€‹</a></h3>
<p>The knowledge of the timing properties of the application under analysis enables the <em>a priori</em> determination of the time instants when both inputs are expected and those when only the lidar has new data available.
Lingua Franca allows to dynamically change the <code>maxwait</code> in the reaction body using the <code>lf_set_fed_maxwait</code> API, that takes as input parameter the new <code>maxwait</code> value to set.
This capability of the language permits the automatic emergency braking federate to:</p>
<ul>
<li>start with <code>maxwait</code> statically set to <code>forever</code> (or some finite value for fault tolerance), because at time 0 (startup) both sensors produce data;</li>
<li>set <code>maxwait</code> to 0 after processing both inputs with the same logical time, because the next data will be sent by the lidar only;</li>
<li>set <code>maxwait</code> back to <code>forever</code> after processing the radar input alone, because the next data will be sent by both sensors.</li>
</ul>
<p>This dynamic solution guarantees both consistency and availability as long as lidar data arrives within 50 ms.
The implementation and the instantiation of the <code>AutomaticEmergencyBraking</code> reactor are shown below:</p>
<pre class="shiki"><code>reactor AutomaticEmergencyBraking {
  input lidar_in: float
  input radar_in: float
  output brake: int
  state n_invocs: int = 0

  reaction (lidar_in, radar_in) -&gt; brake {=
    if (lidar_in-&gt;is_present &amp;&amp; radar_in-&gt;is_present) {
      if (sensor_fusion(lidar_in-&gt;value, radar_in-&gt;value) {
        printf(&quot;Sensors detect a close object -&gt; signaling braking\n&quot;);
        lf_set(brake, 1);
      }
    } else if (lidar_in-&gt;is_present) {
      if (lidar_analysis(lidar_in-&gt;value)) {
        printf(&quot;Lidar has detected close object -&gt; signaling braking\n&quot;);
        lf_set(brake, 1);
      }
    }

    self-&gt;n_invocs++;
    if (self-&gt;n_invocs % 2) {
      lf_set_fed_maxwait(0);
    } else {
      lf_set_fed_maxwait(FOREVER);
    }
  =} tardy {=
    printf(&quot;STP violation on AEB\n&quot;);
  =} deadline(100ms) {=
    printf(&quot;AEB deadline violated\n&quot;);
  =}

  federated reactor {
    lidar = new Lidar()
    radar = new Radar()
    
    @maxwait(forever)
    aeb = new AutomaticEmergencyBraking()
    
    brake = new BrakingSystem()

    lidar.lidar_data -&gt; aeb.lidar_in
    radar.radar_data -&gt; aeb.radar_in
    aeb.brake -&gt; brake.signal
  }
}
</code></pre>
<p>The <code>sensor_fusion()</code> function combines the data and returns <code>true</code> if braking is needed.
The <code>lidar_analysis()</code> function uses only lidar data to make a (presumably more conservative) decision.
The <code>n_invocs</code> integer state variable counts the number of times the reaction of the <code>AutomaticEmergencyBraking</code> reactor is invoked. This variable is used to determine how many inputs the reaction expects to see at the next invocation and set the <code>maxwait</code> accordingly. Even invocation numbers mean that the next reaction invocation will happen with both sensor inputs present, so <code>maxwait</code> is set to <code>forever</code>; with odd invocation numbers, the next reaction invocation will see new data from the lidar only, and <code>maxwait</code> is then set to 0.</p>
<p>Clearly, detecting and handling faults would be needed in practical implementation.
This will be the topic of a subsequent blog.</p></div><footer class="docusaurus-mt-lg"><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="../tags/lingua-franca/index.html">lingua franca</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="../tags/federation/index.html">federation</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="../tags/decentralized/index.html">decentralized</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="../tags/consistency/index.html">consistency</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="../tags/maxwait/index.html">maxwait</a></li></ul></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--next" href="../deadlines/index.html"><div class="pagination-nav__sublabel">Older post</div><div class="pagination-nav__label">Working with Deadlines</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#indefinite-wait-for-inputs-aircraft-door-use-case" class="table-of-contents__link toc-highlight">Indefinite wait for inputs: aircraft door use case</a><ul><li><a href="#consistency-with-decentralized-coordination" class="table-of-contents__link toc-highlight">Consistency with decentralized coordination</a></li></ul></li><li><a href="#multirate-inputs-automatic-emergency-braking" class="table-of-contents__link toc-highlight">Multirate inputs: automatic emergency braking</a><ul><li><a href="#desired-system-properties" class="table-of-contents__link toc-highlight">Desired system properties</a></li><li><a href="#dynamic-adjustment-of-maxwait" class="table-of-contents__link toc-highlight">Dynamic adjustment of <code>maxwait</code></a></li></ul></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://zulip.lf-lang.org" target="_blank" rel="noopener noreferrer" class="footer__link-item">Zulip<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="../index.html">Blog</a></li><li class="footer__item"><a href="https://github.com/lf-lang" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2026 The Lingua Franca project. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>